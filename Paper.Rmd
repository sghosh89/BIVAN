---
title: "The importance of a complete statistical description of dependence between variables for ecology and related fields"
author: "Shyamolina Ghosh, Lawrence W. Sheppard, Mark T. Holder, Terrance E. Loecke, P. Chris Reid, Daniel C. Reuman"
date: "December 16, 2018"
geometry: "left=1.5cm,right=1.5cm,top=2.5cm,bottom=2.8cm"

output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: ecology-letters.csl
bibliography: REF_ALL.bib
---

updated on `r Sys.Date()`

```{r setup_Paper, echo=F}
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 5) #This option round all numbers appeared in the inline r code upto 5th digit
#seed<-101
#source("mtime.R") #A function needed for caching
```

# Front matter

*Affiliations:*

Ghosh: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

Sheppard: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

Holder: Department of Ecology and Evolutionary Biology and Biodiversity Institute, University of Kansas, Lawrence, KS, 66045, USA

Loecke: Environmental Studies Program and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA

Reid: 

Reuman: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA; Laboratory of Populations, Rockefeller University, 1230 York Ave, New York, NY, 10065, USA. 

*Possible alternative titles:*

- A complete statistical description of dependence between variables for ecology and related fields

*Keywords:*

*Type of Article*

- Ideas and Perspectives

*The number of words in the abstract*

*The number of words in the main text (excluding abstract, acknowledgements, references, table and figure legends)* 

*The number of words in each text box*

*The number of references*

*The number of figures, tables, and text boxes*

*The name and complete mailing address (including telephone and fax numbers and e-mail address) of the person to whom correspondence should be sent* 

\newpage
# Abstract

We introduce a new rank based "copula" approach to model dependencies between ecological variables. Our method could overcome the shortcomings of the linear correlation approach and give us new insight about "asymmetric tail dependence" found in ecology, biogeochemistry and related field. We focus on three objectives (1) Do datasets in ecology and related fields have non-Normal copula srtructure? Do they show tail dependence distinct from that of a Normal copula, and in particular do they show asymmetric
tail dependence? (2) If so, what are some possible causes of non-Normal copula structure? And (3) what are the
consequences of non-Normal copula structure and tail dependence for our understanding of biology and what are the applications? We present several examples with real data which show asymmetric tail dependence in bivariate as well as multivariate non-Normal copulae. Asymmetric tail dependence can illuminate some important phenomena like "spatial synchrony" and causal relationships between ecological variables (like species abundance and rainfall). We show that the "Moran-effect" and asymmetric sensitivity towards global environmental fluctuations could be the possible causes for non-Normal copula structures. We demonstrate with simulations and real data that non-Normal copulae have profound effects on spatial skewness of species abundances and spatial Taylor's law slope values.  Our method is new and could have potential when exploring some other related phenomena like effects of climate change on extinction risks of metapopulations.

\newpage
# Introduction \label{Intro}

Very generally, all branches of ecology and related areas study relationships among environmental and biological 
variables. However, commonly used correlation- and regression-based 
approaches to studying 
such relationships are limited - it is well understood that common statistical
approaches provide only a very partial description of a relationship between variables. 
For instance, datasets showing markedly different 
relationships may nevertheless have the same correlation coefficient value 
(Fig. \ref{fig_cop_pedag1}A-B). The variables of Fig. \ref{fig_cop_pedag1}A 
(respectively, Fig. \ref{fig_cop_pedag1}B) are principally 
related in the left (respectively, right) portions of their distributions, an asymmetric 
pattern of dependence in the distribution tails that may
have ecological significance, as discussed below, but is not captured by 
correlation. Panels C and D 
were obtained from A and B through monotonic transformation 
(Appendix \ref{SM-pedagog1_details} for details),
which alters the Pearson, but not the Spearman correlation. Although correlation
is only one of the numerous metrics for 
studying relationships between variables, other commonly used metrics also 
provide partial information only.

\begin{figure}
\begin{center}
\includegraphics[width=3.5in]{./Results/PedagogFig1.pdf}
\caption{(A-F, I, J) Bivariate datasets showing diverse relationships between 
variables; many of these datasets nevertheless have the same Pearson (P)
or Spearman (S) correlation coefficients. Panels C and E (respectively, D and F) were 
obtained from A (respectively, B) via monotonic functions that transformed the 
standard-normal marginal distributions of A and B to gamma (C, D) or 
uniform (E, F) marginals (details in Appendix \ref{SM-pedagog1_details}). (G, H) Contours 
of log-scale density functions of Clayton (G) and survival-Clayton 
(H) copulas with parameter 5 (see section on methods for Q1). (I,J) Reflections
of E, F, respectively, about a vertical axis. Subscripts h and v 
stand for "horizontal" and "vertical". \label{fig_cop_pedag1}}
\end{center}
\end{figure}

Well-developed statistical tools do exist, and are 
applied widely in other fields, that provide a demonstrably complete 
description of the dependence 
between two or more variables [@joe2014_dependence; @nelsen2006_copula]. 
The goal of this paper is to illustrate the potential for 
broader application of these
tools in ecology and related fields. The tools are based on 
the statistical concept of the *copula*, which we here 
introduce. Copula approaches separate the information contained in a bivariate 
random variable into two distinct parts: the information contained in the 
marginal distributions (which says nothing about the dependence between the 
variables), and the remaining information (which is solely about
the dependence between the variables). From a data perspective, given 
a sample $(x_i,y_i)$, $i=1,2,\ldots,n$ (e.g., 
Fig. \ref{fig_cop_pedag1}A-B), the associated dependence
or copula structure is revealed by the bivariate plot of $u_i$ versus $v_i$, where
$u_i$ is the rank of $x_i$ in the set of the $x_j$ ($j=1,\ldots,n$), divided by
$n+1$; and $v_i$ is defined in the same way but using the $y_i$. See, 
for instance,
Fig. \ref{fig_cop_pedag1}E-F, which show the copula structure of 
A-B, respectively. Ranking serves to uniformize the 
marginal distributions of the underlying random variables, isolating the 
depedence structure only.
Mathematically, if $(X,Y)$ is a continuous bivariate random
variable and the cummulative distribution functions (cdfs) of $X$ and $Y$ are 
$F_X(x)=P[X\leq x]$ and $F_Y(y)=P[Y\leq y]$, then the dependence or copula structure
of $(X,Y)$ is revealed by the random variable $(F_X(X),F_Y(Y))$.
This random variable takes values in the unit square, 
$[0,1] \times [0,1]$, and has uniform marginal distributions. Probability density 
functions (pdfs) corresponding to the copulas associated 
with Fig. \ref{fig_cop_pedag1}E-F are in Fig.
\ref{fig_cop_pedag1}G-H, respectively. Strictly speaking, 
the copula is actually defined as the bivariate 
cdf of $(F_X(X),F_Y(Y))$ rather than as this random variable itself, 
but this makes little conceptual difference. See @nelsen2006_copula and @joe2014_dependence
for mathematical details. An important theorem of A. Sklar [@sklar1959_theorem] 
states that copulas give a unique and complete 
representation of the dependence
between variables, in the sense that the joint distribution of $(X,Y)$ 
can be reconstructed completely from the 
copula and the marginal distributions. 
Copula theory is also well developed for
multivariate distributions.

A principal benefit of a copula approach to ecological data is 
that such an approach can sensitively model and detect
tail dependence and asymmetries of tail dependence. 
Tail dependence is association between extreme values of two variables. 
If smaller values of two positively associated variables are more 
strongly associated than are larger values, the variables are said to
have stronger lower- or left-tail dependence than right- or upper-tail dependence
(Fig. \ref{fig_cop_pedag1}A, E);
and \emph{vice versa} if larger values are more strongly associated than smaller
ones (Fig. \ref{fig_cop_pedag1}B, F). Datasets of the same 
corelation can have a range of tail dependence 
characteristics (Fig. \ref{fig_cop_pedag}), which can be quantified (see section on
methods for Q1).

\begin{figure}
\begin{center}
\includegraphics[width=16 cm,height=8 cm]{./Results/copula_pedagog_fig_BB1.pdf}
\caption{(A-C) Data generated using the BB1 copula (see section on methods for Q1) 
with three different 
sets of parameters chosen to produce a variety of 
lower-tail (LT) and upper-tail (UT) dependence strengths (methods for Q1), but the same 
Kendall correlation (K) (to two digits) in all cases. (D-F) Similar to A-C, but
with stronger correlation. Asymmetry of tail dependence (LT-UT) is the same 
within each column of panels.\label{fig_cop_pedag}}
\end{center}
\end{figure}

One way we may expect a copula approach 
to better reflect ecological relationships has to do with Liebig's law of the
minimum. If, for instance, the growth of a plant depends on soil 
nitrogen, N, as well
as on other factors, data on soil nitrogen and resulting growth rates may be 
expected to look more like Fig. \ref{fig_cop_pedag1}A or E than like 
Fig. \ref{fig_cop_pedag1}B or F. Nitrogen 
will control plant growth, producing a strong
relationship, only when it is limiting, in the left portion of the N and 
plant-growth-rate distributions. 
Nitrogen will be less related or unrelated to growth rates in the right tails of 
the distributions, as pictured in Fig. \ref{fig_cop_pedag1}A and E. The portion
of the distributions that dominate the overall association is visible in the copula
approach, but may not be reflected by correlation coefficients and other standard techniques.

A second reason we may expect a copula-based approach to benefit 
ecological research is that such an approach may help illuminate 
the causal mechanisms through which variables are related. For instance, if two species
X and Y are strong competitors, we may expect abundances of the two species
across quadrats or through time within a single quadrat to be negatively related, as in 
Fig. \ref{fig_cop_pedag1}I-J. If X is plotted on the horizontal axis
and Y is plotted on the vertical, then the plot in Fig. \ref{fig_cop_pedag1}I 
suggests X is the dominant 
competitor: when X is abundant, Y is necessarily rare because it is suppressed 
by X; whereas when X is rare, Y
may be abundant or may also be relatively rare due to 
limiting factors other than X. 
Alternatively, Fig. \ref{fig_cop_pedag1}J suggests that Y
is the dominant competitor. The copula approach again reveals which portions of the
distributions are principally responsible for the association between variables, and this 
detail may help support or refute alternative mechanistic and causal hypotheses about 
the relationship between the variables.

A third reason we may expect a copula approach to benefit ecological
research is that prior work has demonstrated important copula 
stucture in the spatial dependence of environental 
variables [@Serinaldi2008; @She2018; @Goswami2018;
@li2013]. One may expect copula structure in environmental variables 
to take the form of strong tail dependence if
intense meteorological events are also widespread in their effects, as seems 
frequently to be the case.
Spatial dependence in an environmental variable 
tends to beget dependence across space
in fluctuations of populations or other ecosystem variables 
(this is called \emph{spatial synchrony}) which are influenced by the environmental 
variable. This process is called the \emph{Moran effect}. 
If copula structure is transmitted, 
possibly in modified form, 
from environmental to ecological variables, then we may expect important 
copula structure to be a common feature of spatial synchrony of population, community, 
biogeochemical and other ecological variables.
Synchrony is a phenomenon of great interest in 
ecology [@Liebhold2004; @Sheppard2016; @walteretal2017].

A fourth reason we may expect copula structure to be important
in ecology has to do with spatially aggregated or averaged quantities. 
Many ecological variables of applied importance 
depend on the spatial average or sum of local 
quantities. For instance, regional methane and CO$_2$ 
fluxes are the sum of local fluxes; 
and the total economic value of a fishery is the sum of catches from 
local areas. We will explore how details, captured by copula methods, of the 
nature of the dependence between local quantities can influence the spatial 
mean or sum, and how this may influence human concerns and 
higher organizational levels in 
ecology. Illustrating the idea here, prior work demonstrated that the overall 
reliability of wind-generated electricity depends sensitively on details
of the dependence between wind speeds at multiple generator sites [@li2013]. 
Spatially aggregated ecological variables may show a similar dependence, with
potentially substantial consequences. For instance, if populations of a 
pest species in different locations are all positively associated and also strongly
related to each other in their right tails, then local outbreaks tend 
to occur together, creating regional epidemics. If populations
of a crop or other resource species are strongly 
related in their left tails, then 
episodes of local scarcity occur together, creating regional 
shortages. On the other hand left-tail dependence in the pest species 
or right-tail dependence in the crop, even if overall correlation were 
unchanged, would have much more benign effects.

We approached our overall goal of exploring the potential of 
copula approaches for understanding dependences in ecology by addressing the 
folling specific questions. (Q1) Do datasets in ecology and related fields 
have copula structure distinct from that of a Gaussian/normal distribution (here called 
non-normal copula structure)? Do they show tail dependence distinct from that 
of a normal distribution, and in particular do they show asymmetric tail 
dependence? (Q2) If so, what are some possible causes/mechanisms of this 
non-normal copula structure? And (Q3) what are the consequences of non-normal 
copula structure and tail dependence for our understanding of biology and for 
applications? To address Q1, we analyze several datasets, including 
environmental, species-trait, phenological, population, community, and 
ecosystem functioning data. We selected these datasets to span multiple 
sub-fields and organizational levels of ecology, in an attempt to be 
reasonably representative of the field as a whole. The second section of the 
paper introduces the data, and the third and fourth sections use the data to 
address Q1. The fifth and sixth sections, which address Q2, use simple models to 
explore mechanisms. The seventh and eigth sections, which address Q3, use both
the data of section two as well as models to explore a variety of consequences
of copula structure and tail dependence for applications and for our understanding
of ecology. The ninth section is the Discussion. 
Copula approaches have been used to great benefit in neuroscience [@onken2009], 
bioinformatics 
[@Kim2008], medical research [@Emura2016], direct study of environmental 
variables [@Serinaldi2008; @She2018; @Goswami2018; @li2013], finance, and other fields. 
To our knowledge, these approaches have been used seldom or never for ecological 
research. We argue that the benefits to ecological research of a complete statistical 
desription of dependence will be substantial, and we hope this paper helps stimulate the
fruitful use of copula approaches across the discipline.

# Data \label{Data} 

```{r read_somedata, echo=F, results='hide'}
d_soilCN<-readRDS("Data/dataForShymolinaCoord.rds")
d_soilCN<-na.omit(d_soilCN)
d_birdsBMR<-readRDS("./Data/BMR/BirdBodyMassesMetabolicRates/my_birdsBMR_data.RDS")
d_mammalsBMR<-readRDS("./Data/BMR/MammalianBodyMassesMetabolicRates/my_mammalsBMR_data.RDS")
d_cc<-readRDS("./Results/Ceder_creek_results/cop_HB_all_yr.RDS")
```

We used datasets that pertain to multiple fields and levels of organization within 
or related to ecology, including environmental, species-trait, phenological, 
population, community, and ecosystem functioning data. Copula structure describing 
the relationship between atmospheric weather variables such as X and Y has been 
examined previously in the meteorological literature (e.g., REF). We therefore 
examined environmental variables from the soil instead, using the Rapid Carbon 
Assessment database (RaCA; @Wills2014).
<!--***DAN: Add Wills and Loecke pending reference if published in time--> 
The database comprises measurements of soil organic carbon and total soil 
nitrogen (Mg C or N per hectare of soil surface) from `r nrow(d_soilCN)` 
locations across the coterminous United States (Fig. \ref{SM-fig_SoilCNmapUSA} for sampling locations).
Measurments were from the central pedon of a soil core, to 1 m depth.
<!--***DAN: Terry to check the wording and accuracy here-->
Species-trait data were average species basal metabolic rate (KJ per hour) and 
body mass (gram) data for `r nrow(d_birdsBMR)`  species of birds [@Mcnab_2009] 
and `r nrow(d_mammalsBMR)`  species of mammals [@Mcnab_2008].
These data have been much studied, but to our knowledge the copula structure 
of the dependence between metabolic rate and body mass has not been examined. 
Species-trait data such as these reflect the coevolution of the two traits.
Phenological data were aphid first-flight dates from 10 locations (Fig. \ref{SM-fig_aphid_map}) 
across the United Kingdom (UK) for 20 aphid species (Table \ref{SM-tab_aphid_info}), for the 
35 years from 1976 to 2010. These time series were computed from the the Rothamsted Insect 
Survey suction-trap dataset [@Macaulay1988, @Harrington2014]. The first of our two 
population-level datasets was also derived from the RIS suction-trap data, and comprised 
total counts of aphids trapped for the same locations, species, and years; these are 
indicators of flying aphid abundance. Data pre-processing for the aphid data was the same as 
that of @Sheppard2016,
but we exlcuded one of the 11 sites they used so as to include only sites with at least 30 
years data.  Our second population dataset comprised average annual abundance estimates 
for 14 locations (Fig. \ref{SM-fig_plankton_map})
in the North Sea and British seas for 22 plankton taxa (Table \ref{SM-tab_plankton_info}) for the 
56 years from 1958 to 2013. The locations are $2^\circ$ by $2^\circ$ grid cells. These data 
were obtained from the Continuous Plankton Recorder (CPR) dataset maintained by the Sir 
Alistair Hardy Foundation for Ocean Science (SAHFOS), now part of the Marine Biological 
Association of the UK. Data pre-processing was similar but not identical to that 
of @Sheppard2017; see Appendix \ref{SM-Data_details} for details.
Community-level data were plant aboveground biomass and Shannon's diversity index for `r nrow(d_cc[[5]])` 
plots, each 9m by 9m, maintained at Cedar Creek Ecosystem Science Reserve and sampled in 
the year 2000 [@Tilman2001; @Tilman2006]. 
Finally, ecosystem functioning data were methane (CH$_{4}$) fluxes between the soil or 
water surface and the troposphere, measured at 13 locations at daily to weekly intervals 
from September 2015 to September 2016 at the Great Miami Wetland mitigation bank in Trotwood, 
Ohio [@Holland1999; @Jarecke2016]. Each included location was measured on at least 50 dates. 
Sampling locations spanned a hydrologic gradient from upland to seasonal wetland.
See Appendix \ref{SM-Data_details} for additional data details. 

The environmental, species-trait, and community datasets, as we studied them, are henceforth 
called the "bivariate" datasets in the sense that they comprise two quantities measured at 
different locations or for different species. The phenology and population datasets are 
"multivariate" in that they comprise, for each taxon, measurements at multiple locations; 
copula structure can be studied for each pair of locations. Likewise the the ecosystem 
functioning (methane flux) dataset was  multivariate in this sense.

# Background, concepts and methods for Q1: detecting copula structure in data \label{Methods}

We addressed Q1 partly via a model selection procedure in which the normal copula
and a variety of alternative copulas were fit to 
our ecological datasets, and fits of the various copula models 
were compared via the Akaike and Bayesian 
Information Criteria (AIC and BIC). To make the results interpretable
to readers unfamiliar with copulas, we first introduce the normal copula and 
some other copulas we used; and we operationally introduce measures of tail dependence
and asymmetry of tail dependence. 
Conceptually, a bivariate copula is essentially a probability density function 
on the unit square with uniform maginals. The normal copula family is a one-parameter
family of copulas, with parameter corresponding to the correlation of the related 
bivariate normal distribtion, and controlling the degree of dependence 
(Fig. \ref{fig_cop_pedag3}A-B for an example).
Left- and right-tail dependence are $0$ for the normal copula, and this 
serves as a benchmark for tail dependence in other copulas - positive values of our
tail dependence measure correspond to dependence stronger than that of a normal
copula. The Clayton and 
survival-Clayton families (Fig. \ref{fig_cop_pedag1}G-H) are two more one-parameter 
families. The Clayton has positive lower-tail dependence ($0.87$ for
the example of Fig. \ref{fig_cop_pedag1}G) and $0$ upper-tail dependence; the 
survival-Clayton, which is a rotation of the Clayton by $180^\circ$, has 
positive upper-tail dependence ($0.87$ in Fig. \ref{fig_cop_pedag1}H)
and $0$ lower-tail dependence. For our model selection procedure (see below), we used 
several one- and two-parameter families of copulas exhibiting a wide variety of 
positive lower-tail dependence values 
(Clayton, survival-Gumbel, survival-Joe, survival-BB6, henceforth
abbreviated, respectively, C, SG, SJ, SBB6) and upper-tail dependence values
(survival-Clayton, Gumbel, Joe, BB6, henceforth abbreviated, respectively, 
SC, G, J, BB6). We also considered families that could exhibit positive upper- or lower-tail
dependence, or both, depending on parameters (BB1, survival-BB1, BB7, survival-BB7, henceforth 
abbreviated, respectively, BB1, SBB1, BB7, SBB7). 
If LT and UT are used to denote 
our two measures of tail dependence, their difference is a measure of asymmetry of 
tail dependence. We also used two families that were asymmetric in their non-tail parts, 
but that had zero tail dependence (BB8, survival-BB8, abbreviated BB8 and SBB8).
In addition to the normal copula, we used another symmetric copula,
the Frank copula (abbreviated F; Fig. \ref{fig_cop_pedag3}C-D). 
Copulas are implemented in the `copula` and `VineCopula` packages for the 
R statistical computing language.
Additional details are in introductory texts 
on copulas [@nelsen2006_copula ; @joe2014_dependence] and in `VineCopula` documentation.
Visualizations of all the copulas we used are in Figs \ref{SM-figped_N}-\ref{SM-figped_SBB8}. 

\begin{figure}
\begin{center}
\includegraphics[width=3.5in]{./Results/PedagogFig3.pdf}
\caption{Log-transformed pdfs (A, C) and samples from (B, D) example copulas.
Shown are the normal copula with parameter $0.8$ and the Frank copula with 
parameter $10$. See also Fig. \ref{fig_cop_pedag1}E-H for the Clayton and  
survival-Clayton copulas with parameter 5. Figs \ref{SM-figped_N}-\ref{SM-figped_SBB8}
have visualizations of all the copulas we used, including more visualizations
of the Clayton and survival-Clayton copulas.\label{fig_cop_pedag3}}
\end{center}
\end{figure}

Question Q1 was answered principally via analysis of the
data using a model selection approach. For bivariate datasets 
$(x_i,y_i)$ for $i=1,...,n$, model selection involved several steps. 
First, as in the Introduction, we produced ranks 
$(\tilde{u}_i,\tilde{v}_i)$ where $\tilde{u}_i$ is the rank of $x_i$ in the set 
$\{x_i:i=1,...,n\}$ and $\tilde{v}_i$ is the rank of $y_i$ in the set $\{y_i:i=1,...,n\}$ and 
we set $u_i=\tilde{u}_i/(n+1)$ and $v_i=\tilde{v}_i/(n+1)$; subsequent analysis used these 
*normalized ranks* $u_i$ and $v_i$. Ranks were $1$ for the smallest element in a set. 
Second, we did a test of the independence of the $u_i$ and $v_i$ 
(implemented in `BiCopIndTest` in the `VineCopula` package). 
Subsequent model 
selection algorithms are ineffective if data could not be distinguished from independent data 
since most or all bivariate copula families we considered include the independent copula in the 
family or as a boundary case. If independence could be rejected ($0.05$ significance level), model 
selection proceeded. Third, we fit the bivariate copula families listed previously to the ranked data 
$(u_i,v_i)$ via maximum likelihood, using the `BiCopEst` function in `VineCopula`, and 
obtained AIC and BIC values and accompanying model weights, $\text{AIC}_{\text{w}}$ and 
$\text{BIC}_{\text{w}}$ [@burnham2003_modelselection]. The weight of a model represents the 
relative support of data for the model; weights sum to 1 across models considered. The lower- and 
upper-tail dependence of the best-fitting member of each family was also provided by `BiCopEst`. 
Fourth, $\text{AIC}_{\text{w}}$ values for all fitted models were used to get
model-averaged lower- and upper-tail dependence values using standard model averaging 
formulas [@burnham2003_modelselection]; likewise for BIC.
Model selection methods will give the *relative* support of several models, but will not,
on their own, indicate whether any of the models selected is an objectively good fit: all 
models considered might poorly describe the data. To test this, and as the final step of
our procedure, we tested the goodness of fit of our AIC-best copula family using a 
bootstrapping procedure implemented in `BiCopGofTest` of `VineCopula`. The method performed 
two tests, one based on a Cramer-von Mises statistic, and one based on a 
Kolmogorov-Smirnov statistic. To keep computation times reasonable, 
an initial run using $100$ bootstraps was performed, and if
the $p$-value resulting from either test was less than $0.2$, tests were re-run with 
$1000$ boostraps.

The first part Q1 was answered for a bivariate dataset 
by comparing the AIC weights of the non-normal copula
families with that of the normal family. 
The second part of Q1 was answered by comparing 
the model-averaged lower- and upper-tail dependence
values to the lower- and upper-tail dependence values of a normal copula (which 
are 0). The third part of Q1
was answered by comparing the difference of the model-averaged lower- and upper-tail 
dependence values to the analogous difference for a normal copula, again 0.
For multivariate datasets,
each of which consists of time series from multiple locations, we carried out the bivariate analysis
for all possible pairwise combinations of locations and compared AIC weights and tail-dependence of 
minimum-AIC copulas with that of the normal copula. We also counted the number of location pairs 
for which model-averaged lower-tail dependence was greater than model-averaged upper-tail dependence 
or vice-versa, and reported the percentage of pairs showing stronger lower-tail dependence out of 
the total number non-independent location pairs considered.

In addition to our model selection approach, we also used nonparametric approaches to 
quantify lower- and upper-tail dependence and to answer Q1. Using two approaches can provide greater confidence 
that results are robust. We used three nonparametric
statistics <!--( $\cor$, $\Ps$ and $\Dsq$)--> which can quantify the extent to which 
two normalized ranks $u_i$ and $v_i$ are 
related in any part of their distributions; we here describe the 
statistics. The statistics were formulated with positively associated
variables in mind. All the variables we study were positively associated
when they were significantly associated. So definitions and associated 
diagrams will assume positive associations, though generalizations are 
straightforward. Given two bounds 
$0 \leq l_b < u_b \leq 1$, we define the parallel lines $u+v=2l_b$ and 
$u+v=2u_b$, which intersect the unit square (Fig. \ref{SM-fig_stat_image}). 
Our statistics quantify the dependence
between $u_i$ and $v_i$ in the region bounded by these lines.
Using $l_b=0$ and some value $u_b\leq 0.5$ can give information about 
dependence in the left parts of the distributions of $u$ and $v$, and 
using $u_b=1$ and $l_b \geq 0.5$ can give information about dependence in 
the right parts of the distributions. 
The first statistic, denoted $\cor_{l_b,u_b}(u,v)$, is the portion of the Spearman 
correlation of $u_i$ and $v_i$ that is attributable to the points 
lying in the region given by the bounds $u+v=2l_b$ and $u+v=2u_b$:
\begin{equation}\label{eq.Cor}
   \cor_{l_b,u_b}(u,v) = \frac{\sum 
   (u_i-\mean(u)) (v_i-\mean(v))}{(n-1)\sqrt{\var(u)\var(v)}}.
\end{equation}
\noindent Here means and sample variances are computed using all $n$ data 
points, but the
sum is over only the indices $i$ for which $u_i+v_i > 2l_b$ and 
$u_i+v_i < 2u_b$. 
Larger values of $\cor_{l_b,u_b}$ indicate stronger positive association
between $u$ and $v$ in the region given by the bounds. The sum of 
$\cor_{0,0.5}(u,v)$ and $\cor_{0.5,1}(u,v)$ (or some other choice of 
$\cor_{l_{b_k},u_{b_k}}(u,v)$ for bounds $l_{b_k},u_{b_k}$ that partition the
interval $(0,1)$) equals the standard Spearman correlation.

We also defined a statistic $\Ps_{l_b,u_b}$ (Appendix \ref{SM-nonparam_stats}), 
which has a similar 
interpretation to $\cor_{l_{b_k},u_{b_k}}(u,v)$; we use both statistics 
because $\cor_{l_{b_k},u_{b_k}}(u,v)$ is more familiar, but 
in some instances $\Ps_{l_b,u_b}$ appears to have more power to
reveal tail dependence than does $\cor_{l_{b_k},u_{b_k}}(u,v)$. 
Our third statistic, $\Dsq_{l_b,u_b}(u,v)$, is the average squared 
distance between points satisfying $u_i+v_i>2l_b$ and 
$u_i+v_i<2u_b$ and the line $v=u$.
<!--***DAN: Shyamolina, is this actually right, i.e., did we use the average, or did we 
use the sum divided by n? Whichever way we did it is OK, but please check the code and revise the above 
text if necessary and insert a comment answering this comment. I tried to check this, myself, 
but I was having a hard time finding where the statistics are implemented. Please also
indicate in your response comment what line of what file has the implementation of these
statistics.
***Shya: In code we used the sum of squared distances divided by n(=number of points lying within two boundaries) which I think okay to be called as "average-squared distance" or (to be precised) average of squared distances of points from 1:1 line.
Reference : CopulaFunctions_flexible.R file, line 24.
***DAN: OK, good, I am leaving these comments here as a reminder-->
Unlike $\cor_{l_b,u_b}$ and 
$\Ps_{l_b,u_b}$, which are large when points satisfying $u_i+v_i>2l_b$ and 
$u_i+v_i<2u_b$ cluster close to the line $v=u$, $\Dsq_{l_b,u_b}$ is 
small in that case. 
Thus large values of $\cor_{l_b,u_b}$ and $\Ps_{l_b,u_b}$ indicate strong 
dependence in the portions of the distributions of $u$ and $v$ given by 
the bounds, whereas small values of 
$\Dsq_{l_b,u_b}$ indicate strong dependence. 

For large datasets (large $n$),
we could use $l_b$ and $u_b$ close together without incurring undue
sampling variation in our statistics, and we could consider 
several different bands $(l_b,u_b)$ to understand how dependence
varies in different parts of the distributions. But for datasets with 
smaller $n$ we considered only $l_b=0$, $u_b=0.5$ and $l_b=0.5$, $u_b=1$.
We use the shorthand $\cor_l=\cor_{0,0.5}$ ($l$ is for "lower") 
and $\cor_u=\cor_{0.5,1}$ ($u$ is for "upper"); likewise $\Ps_l=\Ps_{0,.5}$,
$\Ps_u=\Ps_{0.5,1}$, $\Dsq_l=\Dsq_{0,0.5}$, and $\Dsq_u=\Dsq_{0.5,1}$.

To test for asymmetry of dependence in upper and lower portions of distributions,
we used differences of upper and lower statistics.
The difference $\cor_l-\cor_u$ is expected to be positive if 
dependence in the left halves of the distributions is stronger 
than dependence in their right halves; likewise for $\Ps_l-\Ps_u$.
The difference $\Dsq_u-\Dsq_l$ (note the opposite order), is also expected to be 
positive under the same conditions. These statistics were used for smaller datasets.
For large datasets, we used $\cor_{l_b,u_b}-\cor_{1-u_b,1-l_b}$, 
$\Ps_{l_b,u_b}-\Ps_{1-u_b,1-l_b}$ and
$\Dsq_{1-u_b,1-l_b}-\Dsq_{l_b,u_b}$ with $l_b=0$ and $u_b$ close to $0$. 
How close depended on $n$, and was chosen to ensure that sample variation 
was not unduly large. We tested our statistics by testing whether 
$\cor_l-\cor_u$, $\Ps_l-\Ps_u$, and $\Dsq_u-\Dsq_l$ revealed the asymmetry of 
tail dependence known to be present in data simulated from various copulas 
(Appendix \ref{SM-Test_npa_stat}, Figs \ref{SM-fig_stat_testing35}-\ref{SM-fig_stat_testing1000}). 

For bivariate datasets, we compared values 
of the statistics $\cor_{l_b,u_b}$,
$\Ps_{l_b,u_b}$, $\Dsq_{l_b,u_b}$, $\cor_{l_b,u_b}-\cor_{1-u_b,1-l_b}$, 
$\Ps_{l_b,u_b}-\Ps_{1-u_b,1-l_b}$ and
$\Dsq_{1-u_b,1-l_b}-\Dsq_{l_b,u_b}$ to 
distributions of values of the same statistics computed on surrogate datasets that were produced from 
the empirical data by randomizing it in a special way to have no 
tail dependence (Appendix \ref{SM-surrog_test}). 
The surrogate/randomized datasets had exactly 
the same marginal distributions as the empirical data and had very similar Kendall or Spearman 
correlation (the algorithm had two versions, one for preserving each correlation coefficient), 
but had normal copula structure. Thus our comparisons tested the null hypothesis 
that our statistics took values on the empirical data no different from what would have been expected 
if the copula structure of the data were normal, but the data were otherwise 
statistically unchanged. 

The comparison of one of the
statistics $\cor_{l_b,u_b}$, $\Ps_{l_b,u_b}$, $\Dsq_{l_b,u_b}$, as computed on the 
empirical data, to the distribution
of its values computed on many surrogate datasets 
provides a test of whether dependence in the part of the distribution specified 
by $l_b$ and $u_b$ is different from
what would be expected from a null hypothesis of normal copula structure but 
unchanged marginals and similar 
Kendall (or Spearman)
correlation. Thus the comparison helps answer the first two parts of Q1
for bivariate datasets. 
Significant deviations correspond to deviations from normal 
copula structure. In particular, deviations 
using $l_b=0$ and $u_b$ small (say, $0.1$) correspond to lower tail dependence 
different from that of a normal copula;
likewise, using $l_b=0.9$ and $u_b=1$ tests for upper tail dependence different 
from that of a normal copula.
The comparison of one of the statistics 
$\cor_{l_b,u_b}-\cor_{1-u_b,1-l_b}$, 
$\Ps_{l_b,u_b}-\Ps_{1-u_b,1-l_b}$ and
$\Dsq_{1-u_b,1-l_b}-\Dsq_{l_b,u_b}$,
as computed on the empirical data, to the distribution of its values on many surrogate datasets 
provides a test of asymmetry of dependence. Thus this comparison helps answer the
third part of Q1 for bivariate 
datasets. For multivariate datasets, we used a spatial resampling scheme 
(Appendix \ref{SM-spatial_resamp}) to calculate confidence intervals, instead of the surrogate 
approach described above.

<!--***DAN: If we end up being desperate to cut length, and assuming the nonparmetric results
are sufficiently similar to model selection results, we may be able to put everything about 
the nonparametric results in the supp mat and just say in the main text that we also used a 
nonparametric approach and it gave the same general conclusions. Though it may take some work
to split out the two approaches and all their results from each other.-->

# Results for Q1: Ecological datasets often have non-normal copula structure and asymmetric tail dependence \label{Results}

```{r read_BivMS_soilCN_data,echo=F}
d<-readRDS("Data/RaCA_soilorganicC_soiltotalN_stocks100cm.RDS")
d<-d[,c("SOCstock100","TSNstock100")] #raw soilCN data
BivMS_res_Loecke<-readRDS("./Results/fitting_results/BivMS_soilCN.RDS")
```

```{r read_RES_aphid_count, echo=F}
RES_aphid_count<-readRDS("./Results/fitting_results/AphidCopulaFit_selecloc_count_species_10.RDS")
```

Across essentially all the sub-fields and levels of organization within ecology for which we 
examined a dataset, copula structures were typically non-normal and variables 
commonly exhibited asymmetric tail 
dependence. To make results easier to absorb for readers who are new to copulas: we first 
present results in detail for an example bivariate dataset; then we summarize results
for all bivariate datasets; then we present results in 
detail for an example multivariate dataset; then we summarize results 
for all multivariate datasets.

<!--bivariate example-->
We present the example of the soil C and N data (see Data), pictured in 
Fig. \ref{fig_biv_multi_raw_cop}A (raw data) and E (copula plot). The variables were 
non-independent ($p=$ `r BivMS_res_Loecke$IndepTestRes`, to within the precision available 
from `BiCopIndTest` in the `VineCopula` package); non-independence is also visually apparent
(Fig. \ref{fig_biv_multi_raw_cop}A,E).
The Kendall correlation was `r round(BivMS_res_Loecke$TauVal,2)`. We fitted the 16 copulas
mentioned in the previous section to the 
data pictured in Fig. \ref{fig_biv_multi_raw_cop}E; AIC and BIC weights and corresponding
lower- and upper-tail statistics for the fitted distributions were computed (Table \ref{SM-tab_soilCNfit}). 
`r BivMS_res_Loecke$InfCritRes$copname[which.max(BivMS_res_Loecke$InfCritRes$AICw)]` was the 
minimum-AIC copula, with AIC weight `r round(max(BivMS_res_Loecke$InfCritRes$AICw),2)`, whereas the 
normal copula had AIC weight essentially 0, answering the 
first part of Q1 for these data. 
The model-averaged lower- and upper-tail dependence statistics were `r round(BivMS_res_Loecke$relLTdep_AICw,3)` 
and `r round(BivMS_res_Loecke$relUTdep_AICw,3)`, respectively (AIC weights were used for model averaging). 
These values are distinct from what a normal copula would give, namely, 0, answering the second part 
of Q1 for these data. The values also differed substantially 
from each other, answering the third part of Q1. The numbers reflect stronger upper- than lower-tail
dependence for the soil C and N data, and this can also be seen visually in extreme upper-right
and lower-left corners of the copula plot (Fig. \ref{fig_biv_multi_raw_cop}E).

\begin{figure}
\begin{center}
\includegraphics[width=6.5in]{./Results/BivarDataPlot.pdf}
\caption{Upper panels show raw data plots for (A) soil C and N data, (B) $\log_{10}$(basal metabolic rate (BMR)) vs. $\log_{10}$(body mass) 
for birds, (C) $\log_{10}$(BMR) vs. $\log_{10}$(body mass) for mammals, and (D) above-ground plant biomass vs. Shannon's index (H) from Cedar Creek. Bottom panels show the corresponding copula plots. See text for units used in upper panels. \label{fig_biv_multi_raw_cop}}
\end{center}
\end{figure}
<!--***DAN: We need to change the point plotting on these panels and other figures to use
translucent points. Right now you cannot tell how many points are piled up in some parts of
these plots, and we can easily fix that-->

Although these results do convincingly show non-normal copula structure, 
we caution that the model-averaged tail-dependence statistics may have been biased 
because even the lowest-AIC copula 
(`r BivMS_res_Loecke$InfCritRes$copname[which.max(BivMS_res_Loecke$InfCritRes$AICw)]`) 
was a poor fit ($p=$ `r BivMS_res_Loecke$GofRes_CvM` and `r BivMS_res_Loecke$GofRes_KS` for the 
Cramer-von Mises and Kolmogorov-Smirnov goodness-of-fit tests, respectively, to within the precision 
available from `BiCopGofTest` in the `VineCopula` package). However, nonparametric statistics verified
both that tail dependence was distinct from that of an N copula for the soil data, and that it 
was asymmetric (Fig. \ref{SM-fig_soilCN_nonparam}, Table \ref{SM-tab_soilCN_asym}). 
The values of the statistics $\cor_{l_b,u_b}$, $\Ps_{l_b,u_b}$ and $\Dsq_{l_b,u_b}$ for real data
were compared to distributions of their values on 1000 Kendall- or Spearman-preserving N surrogates
of the data,
separately in two comparisons for each of the ranges $(l_b,u_b)=(0,0.1),\ldots,(0.9,1)$ 
(Fig. \ref{SM-fig_soilCN_nonparam}). Results show that tail dependence of data is stronger in 
both the lower and upper tails than would be expected under a null hypothesis of a normal copula.
The values of the statistics $\cor_{0,0.1}-\cor_{0.9,1}$, $\Ps_{0,0.1}-\Ps_{0.9,1}$ and
$\Dsq_{0.9,1}-\Dsq_{0,0.1}$ for real data were also compared to distributions of their values
on 1000 Kendall- or Spearman-preserving N surrogates, separately in two comparisons for each
of the $(l_b,u_b)$ ranges listed above (Table \ref{SM-tab_soilCN_asym}). Results showed that
upper-tail dependence was significantly stronger than lower-tail dependence.

<!--bivariate summary-->
Table \ref{tab_bivar_summary} summarizes bivariate results for Q1. For all $4$ 
bivariate datasets, the two variables were always significantly related 
(Table \ref{tab_bivar_summary}, row 1). A non-normal copula 
always emerged as the lowest-AIC (highest-AIC-weight) copula 
(Table \ref{tab_bivar_summary}, row 2). 
The N copula was always a poor fit compared to the highest-AIC-weight copula 
(Table \ref{tab_bivar_summary}, rows 3-4), answering the first part of Q1. 
Upper- and lower-tail statistics (Table \ref{tab_bivar_summary}, rows 7-8) 
differed substantially from 0, the tail dependence statistics of 
the N copula, answering the second part of Q1; and also differed substantially from each other
(Table \ref{tab_bivar_summary}, row 9),
answering the third part of Q1. The first three datasets had stronger upper- 
than lower-tail dependence, and the last dataset had the reverse. 
Although these results convincingly show non-normal copula structure, the 
model-averaged tail-dependence statistics may have been biased 
because even the lowest-AIC copula was a poor fit in some cases 
(Table \ref{tab_bivar_summary}, rows 5-6).
But our nonparametric statistics confirmed the same conclusions 
(Table \ref{tab_bivar_summary}, row 10).
Detailed results for each dataset are in Tables \ref{SM-tab_soilCNfit} - \ref{SM-tab_cc_asym_2000} 
and Figs. \ref{SM-fig_soilCN_nonparam} - \ref{SM-fig_cc2000_nonparam}. 

We present our analysis of the green spruce aphid abundance data (see Data)
as an example multivariate analysis.
Independence was tested for each pair of the 10 sampling locations, and was 
rejected in every case.
<!--***DAN: Right, Shyamolina? I am assuming that because "Indep" does not 
appear anywhere in Table S11, this is correct, but please confirm or correct.
***Shya: Yes, you are right, all the pairwise sampling locations for aphid data rejected independence test and show copula structures.
***DAN: Good, thanks, leaving these comments here as a reminder-->
Model selection among copulas was carried out separately for each pair of locations.
Best-fitting (lowest-AIC) copulas were non-normal
for the large majority of location pairs (Table \ref{SM-tab_count_bestcop}), and 
AIC weights for the best-fitting copulas (Table \ref{SM-tab_count_AICw}) 
were typically substiantially 
larger than those for the N copula (Table \ref{SM-tab_count_AICw_normal}), answering 
the first part of Q1 from the Introduction for these data.
Goodness of fit tests based on a Cramer-von Mises statistic 
(Table \ref{SM-tab_count_p_CvM}) in every case 
failed to reject the hypothesis that the AIC-best copula family was also 
an objectively adequate description of 
the data, and likewise for goodness of fit tests based on a Kolmogorov-Smirnov 
statistic (Table \ref{SM-tab_count_p_KS}), demonstrating that the collection of 
copula families we used was sufficiently broad that the copulas of all pairs of 
locations could be characterized by at least one of them, for these data.
Model-averaged lower- (Table \ref{SM-tab_count_LTdep_AICw}) and upper-tail
(Table \ref{SM-tab_count_UTdep_AICw}) dependence statistics were exclusively 
positive and were frequently substantially large, thereby differing 
from what an N copula would give (i.e., 0), and answering the second part of 
Q1 for these data. Apparently these aphid data have greater tail dependence 
(both lower and upper) than would be expected from an N-copula null hypothesis. 
Model-averaged lower-tail dependence statistics minus model-averaged 
upper-tail dependence statistics (Table \ref{SM-tab_count_LTmUT}) were positive 
for all but a few locations pairs (`r sum((RES_aphid_count$LTdep_AICw-RES_aphid_count$UTdep_AICw)>0,na.rm=T)` 
out of `r (dim(RES_aphid_count$gfc_p_CvM)[1]^2-dim(RES_aphid_count$gfc_p_CvM)[1])-2*RES_aphid_count$num_indep_loc_pair`), 
indicating that lower-tail dependence across space was much stronger than upper-tail 
dependence. Thus the spatial synchrony of rarity in green spruce aphid is stronger 
than the spatial synchrony of outbreak events. This also answers the third part of Q1.

<!--Non-parametric analysis of tail dependence, green spruce aphid abundance data-->
Nonparametric statistics verified that tail dependence was asymmetric for the green 
spruce aphid abundance data.
Mean values across all pairs of locations of the statistics 
$\cor_l$, $\cor_u$, $\Ps_l$, $\Ps_u$, $\Dsq_l$, and $\Dsq_u$ were positive and
confidence intervals excluded $0$ (Table \ref{SM-tab_count_resamp}). 
Mean values of the statistics $\cor_l-\cor_u$, $\Ps_l-\Ps_u$, and $\Dsq_u-\Dsq_l$
also were always positive and had confidence intervals that excluded $0$ 
(Table \ref{SM-tab_count_resamp}), confirming asymmetry of tail dependence and 
stronger lower- than upper-tail dependence. Each of the statistics 
was plotted against geographic (great-circle) distances between sampling locations, 
across all pairs of sampling locations (Fig. \ref{SM-fig_aphid_count}). 

<!--multivariate summary-->
Table \ref{tab_multivar_summary} summarizes some of our results using our
multivariate data. In addition to summaries of the green spruce aphid abundance data results 
elaborated in detail above, the table also summarizes results for 
leaf-curling plum aphid first flight data, abundance data for the dinoflagellate
\textit{Ceratium furca}, and methane-flux data (see Data). Results supported the 
conclusions that non-N copula structure, non-N tail dependence, and asymmetric tail 
dependence were common. Most locations pairs were non-independent 
(Table \ref{tab_multivar_summary}, row 2). The large majority of non-independent location 
pairs had best-fitting copula that was not the N copula (Table \ref{tab_multivar_summary}, 
row 3), and AIC weights of best-fitting copulas were 
substantially better than AIC weights of N copulas (Table \ref{tab_multivar_summary}, rows 4-5).
For these data, best-fitting copulas were nearly always considered an adequate fit, 
according to Cramer-von Mises and Kolmogorov-Smirnov goodness of fit tests 
(Table \ref{tab_multivar_summary}, row 6). Some of the datasets (green spruce aphid
abundance, \textit{Ceratium furca} abundance, methane flux) showed stronger 
or marginally stronger lower- than upper-tail dependence 
(Table \ref{tab_multivar_summary}, rows 7-9), whereas leaf-curling plum aphid first flight
data showed the reverse. Asymmetry results were verified by nonparametric approaches 
(e.g., Table \ref{tab_multivar_summary}, row 10). Detailed results are in 
Tables \ref{SM-tab_count_bestcop}-\ref{SM-tab_methane_resamp} and 
Figs \ref{SM-fig_aphid_count}-\ref{SM-fig_methane}.
We also carried out the same analyses for abundance and first-flight data for the 18 
aphid species for which we had data other than the green spruce and leaf-curling plum aphids,
as well as for the 21 plankton taxa for which we had abundance data other 
\textit{Ceratium furca} (results not shown). The conclusions were generally supported that 
non-N copula structure and tail dependence, as well as asymmetry of tail dependence, are 
very common.


<!--
```{r tab_bivar_summary, echo=F, results='markup'}
tab_bivar_summary<-readRDS("./Results/tab_bivar_summary.RDS")
knitr::kable(tab_bivar_summary, 
             format='pandoc',
             caption = "Summary of results for bivariate data-sets : \\textbf{p.Independence.test}: p-value from `BiCopIndTest`, \\textbf{minimumAIC.bestfit.copula}: best fit copula based on minimum AIC, \\textbf{Bestfit.copula.AICw}: AIC-weight of that best fit copula, \\textbf{Normal.copula.AICw}: AIC-weight of Normal copula, \\textbf{p.CvM}: p-value from `BiCopGofTest` for Cramer-von Mises method, \\textbf{p.KS}: p-value from `BiCopGofTest` for Kolmogorov-Smirnov method,\\textbf{LT.model.avg}: AIC-weights model averaged lower tail dependence, \\textbf{UT.model.avg}: AIC-weights model averaged upper tail dependence, \\textbf{(LT-UT).model.avg}:  AIC-weights model averaged (lower-upper) tail dependence. Statistic $\\Ps_l$ - $\\Ps_u$ for the actual copula data and for Kendall-correlation preserving $1000$ Normal surrogates were computed and ranked in ascending order. Rank for real data \\textbf{Rank.(Pl-Pu)}, if were $>975$ or $<25$, then indicated a significantly ($95\\%$ CI) different lower or upper tail-dependent measures based on Normal-null hypothesis.
\\label{tab_bivar_summary}",
             booktabs=TRUE)
```

```{r tab_multivar_summary, echo=F, results='markup'}

tab_multivar_summary<-readRDS("./Results/tab_multivar_summary.RDS")
knitr::kable(tab_multivar_summary, 
             format='pandoc',
             caption = "Summary of results for multivariate data-sets : \\textbf{num.pairs}: total number of location pairs (excluding self-comparison) considered, \\textbf{num.non-indep}: how many location pair copula are non-independent among them, \\textbf{num.non-N}: number of non-Normal copula as best fit (based on highest AIC-weight), \\textbf{Avg.best.AICw}: average AIC-weights of best fit copula from all location pair, \\textbf{Avg.N.AICw}: average AIC-weights of Normal copula from all location pair, \\textbf{num.good.fit}: number of location pair for which best fit copula have p-values $>$ 0.01 
(both Cramer-von Mises and Kolmogorov-Smirnov method), \\textbf{0.025-CI.LT}: lower and \\textbf{0.975-CI.LT}: upper quantile ($95\\%$CI) of model averaged (AIC-weight based) lower tail dependence from all location pair, \\textbf{0.025-CI.UT}: lower and \\textbf{0.975-CI.UT}: upper quantile ($95\\%$CI) of model averaged (AIC-weight based) upper tail dependence from all location pair, \\textbf{num.LT-UT>0}: number of location pair which showed stronger lower tail dependence than upper, Last $6$ rows summarized the non-parametric analysis results for $\\Ps$ statistics : lower and upper quantile ($95\\%$CI) of $\\Ps_l$, $\\Ps_u$, $\\Ps_l-\\Ps_u$ based on resampling location pair.\\label{tab_multivar_summary}",
             booktabs=TRUE)
```
-->

<!--bivariate table summary in latex format-->
```{r tab_bivar_summaryl, echo=F, results='asis',message=F}
tab_bivar_summary<-readRDS("./Results/tab_bivar_summary.RDS")
row.names(tab_bivar_summary)<-NULL
library(kableExtra)
library(dplyr)
library(tibble)

dt <- tibble(Description = c("1. P-value, independence test",
           "2. Minimum-AIC copula",
           "3. AIC weight of minimum-AIC copula",
           "4. AIC weight of N copula",
           "5. P-value, Cramer-von Mises goodness of fit test",
           "6. P-value, Kolmogorov-Smirnov goodness of fit test",
           "7. Model averaged lower-tail dependence",
           "8. Model averaged upper-tail dependence",
           "9. Model averaged lower- minus upper-tail dependence",
           "10. Asymmetry rank in surrogates")
)
tab_bivar_summary<-cbind(dt,tab_bivar_summary)
knitr::kable(tab_bivar_summary, 
             format="latex",
             caption = "Summary of Q1 results for bivariate datasets. The $p$-values in rows 5-6 are for the minimum-AIC copula. Model averaging used for rows 7-9 was based on AIC weights. For row 10, the statistic $P_{0,0.1}-P_{0.9,1}$ was computed for real data and for 1000 Kendall-preserving surrogate datasets with N copulas, and the rank of real-data value in the distribution of surrogate values is presented. If ranks were $>975$ or $<25$, asymmetry of tail dependence was significant compared to a N-copula null hypothesis. The value of $u_b$ used depended on the size of the dataset, and can be found in Figs. \\ref{SM-fig_soilCN_nonparam} to \\ref{SM-fig_cc2000_nonparam} and Tables \\ref{SM-tab_soilCN_asym}, \\ref{SM-tab_bmr_birds_asym}, \\ref{SM-tab_bmr_mammals_asym}, and \\ref{SM-tab_cc_asym_2000}. \\label{tab_bivar_summary}",
             booktabs=T, linesep = "\\addlinespace",
             col.names = c(" ", "Soil C and N", "Bird masses and BMR", "Mammal masses and BMR", "Cedar Creek data")
             )%>%column_spec(2:5,width="1.4cm")%>%
             column_spec(1, width = "8.5cm")%>%kable_styling(latex_options = "basic",position = "center")
```
<!--***DAN: Shya, it says Pl-Pu above, but I suspect it was P_first slice - P_last slice, right?
Can you please look back at the code, if necessary, and write a comment below this one 
indicating what results are actually presented in the table?
***Shya: Yes, you are right, here Pl-Pu means P_first slice - P_last slice. In table, item 10 : Assymetry rank is shown for Kendall preserving surroagates.
Reference : bivfunctionplot.R file, lines 134,135,161
***DAN: OK, great. I have made changes to deal with this, but am leaving the comment for now
as a reminder that we looked at this-->

<!--multivariate table summary in latex format-->
```{r tab_multivar_summaryl, echo=F, results='asis',message=F}
tab_multivar_summary<-readRDS("./Results/tab_multivar_summary.RDS")
tab1<-tab_multivar_summary[c(1:7,9,11,12,14,16),] # see carefully if you rearrange tab_multivar_summary's row
                                                   #in suppmat this will change
tab2<-tab_multivar_summary[c(8,10,13,15,17),]  # see carefully if you rearrange tab_multivar_summary's row
                                                   #in suppmat this will change

two_tab_in1 <- as.data.frame(do.call(cbind, lapply(1:ncol(tab1), function(i) paste0(" (",tab1[c(7:8,10:12),i], " , ",tab2[ , i], ")") )))   # see carefully if you rearrange tab_multivar_summary's row in suppmat this will change

colnames(two_tab_in1)<-colnames(tab_multivar_summary)
rownames(two_tab_in1)<-c("CI_LT","CI_UT","CI_Pl","CI_Pu","CI_Pl-Pu")

tab_multivar_summary<-rbind(tab_multivar_summary[c(1:6),],
                            two_tab_in1[1:2,], #CI of LT, CI of UT
                            tab_multivar_summary[11,],
                            two_tab_in1[5,] #CI of Pl-Pu
                           )

row.names(tab_multivar_summary)<-NULL
library(kableExtra)
library(dplyr)
library(tibble)
dt <- tibble(
            Description = c("1. Location pairs (excluding self comparisons)",
           "2. Number of non-independent pairs",
           "3. Number of pairs with non-N copula as best fit",
           "4. Average AIC-weights of best-fitting copulas across location pairs",
           "5. Average AIC-weights of N copula across pairs",
           "6. Number of well-fitting location pairs",
           "7. 2.5$^{th}$ and 97.5$^{th}$ quantiles of model-avg. lower-tail dependence",
           "8. 2.5$^{th}$ and 97.5$^{th}$ quantiles of model-avg. upper-tail dependence",
           "9. Percent pairs showing stronger lower tail dependence",
           "10. 2.5$^{th}$ and 97.5$^{th}$ quantiles of $<$P$_{l}$ - P${_u}$$>$ across all location pair")
           )

tab_multivar_summary<-cbind(dt,tab_multivar_summary)

knitr::kable(tab_multivar_summary, 
             format="latex", escape = F,
             caption.short = "Summary of results for multivariate data sets",
             caption = "Summary of results for multivariate data-sets. Rows 3-9 of the table were computed for the non-independent pairs (row 2) only; row 10 was for all location pairs. A well-fitting location pair (row 6) was one for which the best-fitting copula had $p$-values $>0.01$ for both the Cramer-von Mises and Kolmogorov-Smirnov goodness of fit tests. \\label{tab_multivar_summary}",
             booktabs=T, linesep = "\\addlinespace",
             col.names = c(" ","Green spruce aphid abundance",
                        "Leaf-curling plum aphid first flight",
                        "Ceratium furca abundance","Methane flux")
             )%>%column_spec(2:5,width="2.5cm")%>%
             column_spec(1, width = "7cm")%>%kable_styling(latex_options = "basic",position = "center")
```

<!--***DAN: made it to here, 2018 1 10, 1252pm-->

<!--Question 2 analyses-->
# Background, concepts and methods for Q2: causes/mechanisms of non-normal copula structure \label{Causes}

Having demonstrated that non-N copula structure and asymmetric tail dependence are common
features of ecological data, we explore via mathematical 
models two possible mechanisms of this structure which 
seem likely to operate in diverse ecological scenarios. The first mechanism 
is an extension of the well known Moran
effect, and was summarized conceptually in the Introduction. 
It explores the idea that non-N copula structure and asymmetric tail dependence 
between environmental variables measured in two places may bring about similarly 
structured dependence between ecological variables that are influenced by the 
environmental variables. Let $P_i(t)$ be a population index for location $i$ ($i=1,2$),
and assume the index follows AR(1) dynamics within a patch, 
$P_i(t+1)=\beta P_{i}(t-1)+ \sqrt{1-\beta^2} \epsilon_i(t)$. Here the $\epsilon_i(t)$ are 
standard-normal random variables that are independent for distinct times, $t$, but 
that are non-independent across patches. 

<!--***DAN: Note to self, this model, and also the other one we study in this section,
are actually much more general than populatin. Should replace P_i with E_i where E_i is
just some ecological variable. Could be deviaitons from a pop from carrying capacity, could be a 
biogeochemical variable, could maybe even be an evolutinary variable. Anything that is
affected by an environmental variable and could reasonably be modelled by an AR process. 
So the generalization to biogeochemical and community
data seems pretty straightforward. Need to think this through and reword the corresponding
part of the intro to encompass this greater generality. How would the evolutionary case work?
Well, suppose the two "patches" are actually traits, and the perturbations epsilon are somehow
the "drift events" or something like that? This does not really make sense, strictly speaking,
now that I am thinking about it, but maybe the model could be modified to make it make sense?
At least I have straightforward generalization to biogeochem and community cases. 
More on evolutionary: suppose we model traits as a bivariate random walk where the perturbations
in the traits are related with a copula with some tail dependence. Suppose you have a tree and 
you model evolution down the tree in this way and then look at the bivariate distribution of
trait on the tips of the tree. What do you get? I guess you get some copula structure?-->

To begin with, we chose a two habitat patch ($i = 1, 2$) with AR(1) model [Eq. \ref{eq.AR1}] where population $P_{i}$ at time $(t+1)$ depends upon its past value at $(t)$ and the iid noise (assumed to be caused by environmental fluctuations) $\epsilon_{i} (t)$.  

\begin{equation}\label{eq.AR1}
P_{i}(t+1)=\beta P_{i}(t)+\alpha \epsilon_{i}(t)
\end{equation}

To keep $Var(P_{i}(t+1))$ equal to unity, we set noise coefficient $\alpha$ in terms of AR coefficient $\beta$ as $\alpha = \sqrt(1-\beta^2)$. We showed with Eq. \ref{eq.AR1} in the next section that both model selection method and non-parametric analysis indicated similar tail dependence in population copula as that of noise copula. <!--Asymmetric sensitivity and copula structure in populations-->
\textbf{(ii)} 



The second mechanism, which was also summarized in the introduction,
relates to Liebig's law of the minimum, or, more generally, to the potential for 
environmental variables to influence ecological variables through nonlinear relationships.




Secondly, we intended to see if any specific (lower or upper) tail dependence emerges from a copula of two meta-populations, due to some global environmental factors (like temperature or snowfall) which behaved differently beyond a certain expectation threshold (as shown in Eq. \ref{eq.AS_g}). To test the assymetric sensitivity, we constructed a two habitat patch model for population $P_{i} (i=1,2)$ as follows;

\begin{equation}\label{eq.AS}
P_{i}(t+1) = b P_{i}(t) + g(\varepsilon_{i}(t)) + h(\delta_{i}(t))
\end{equation}

$b$ was the linear growth rate. Global environmental fluctuation function $g(\varepsilon)$ can take up any one form between $g_{1}$ and $g_{2}$ (Eq. \ref{eq.AS_g}, Fig. \ref{fig_ms_asym_b_0.1}) where $\varepsilon=(\varepsilon_{1}, \varepsilon_{2})$ was an iid through time with mean zero and covariance matrix $\Sigma_{\varepsilon}$. Local environmental fluctuation function $h(\delta)$ varied according to Eq. \ref{eq.AS_h} where $a$ was the scaling parameter between $0$ to $1$. $\delta=(\delta_{1}, \delta_{2})$ was an iid across $i=(1,2)$ and time with mean zero and covariance matrix $\Sigma_{\delta}$. With this model we showed tail dependence in population copula changed from lower to upper tail dependence as global noise copula $g(\varepsilon)$ changed its form from $g_{1}$ to $g_{2}$ (Eq. \ref{eq.AS_g}).

\begin{align}
g(\varepsilon) = \begin{cases} 
g_{1} = \begin{cases}
\varepsilon & \text{if $\varepsilon< 0$}; \\
0 & \text{otherwise}.
\end{cases}\\ \\
g_{2} = \begin{cases}
\varepsilon & \text{if $\varepsilon> 0$}; \\
0 & \text{otherwise}\label{eq.AS_g}.
\end{cases}
\end{cases} \text{where } \varepsilon = N(\textbf{0},\Sigma_{\varepsilon})\;\ \text{with} \;\ \Sigma_{\varepsilon} = \begin{bmatrix} 1 & r \\ r & 1 \end{bmatrix}
\end{align}

\begin{equation}\label{eq.AS_h}
h(\delta) = a \delta = aN(\textbf{0},\Sigma_{\delta})\;\ \text{with} \;\ \Sigma_{\delta} = \begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix}
\end{equation}

# Results for \hyperref[Intro]{\textbf{(Q2)}}: similar tail dependence in population copula as that of noise copula \label{Results_Q2}

To test environmental effect on population copula from the model \ref{eq.AR1} with $\beta = 0.5$, we measured 3 types of correlations (Spearman, Kendall, Pearson) and different types of non-parametric tail-dependence statistics for both bivariate noise copula and resultant population copula (following model \ref{eq.AR1}) for $50$ simulations. Then we plotted mean of each measured quantity with standard error against Kendall's correlation of the noise copula family. Fig. \ref{SM-fig_Cause4copula_C_kend_ar1} compares the statistics from population copula and the copula made of noises drawn from Clayton (lower tail dependent copula family). We also carried out a paired t-test to compute the p-values of each statistic for noise and population data and found that the nature of tail dependence in noise and populations remained similar but they were not exactly the same except in Pearson correlation coefficient which verified the Moran effect on the population data caused by environmental noise. (For code see [`Plotter_Cause4copula_stat`](https://github.com/sghosh89/BIVAN/blob/master/Cause4copula.R) function). Linear regression between tail statistics from noise and population copula (Fig. \ref{fig_Cause4copula_scatter_C_kend_ar1}) confirmed that the asymmetric tail dependence in noise copula caused similar tail dependence in population copula. We did the same analysis with other asymmetric uniparameter copula family and got similar tail dependence in resultant population copula (see Figs. \ref{SM-fig_Cause4copula_SC_kend_ar1} - \ref{SM-fig_Cause4copula_SJ_kend_ar1}). We also measured tail-dependence between noise and population copula for non-linear stochastic Ricker model and found that our hypothesis of similar tail dependence held true for weak non-linearity regime (see Appendix \ref{SM-cause4copula_ricker}).

<!--
***SG : commented out this section as it gives the similar interpretation but in a more complex way.
our approach is of two-fold : First, we calculated the parameter values of the noise-copula (for example, we chose Clayton with lower tail dependence, in this case the parameter of interest is $\theta$, which determines the strength of association of the variables [@nelsen2006_copula]) using `iRho` or `iTau` function from `copula` package for Spearman's Rho or Kendall's Tau, respectively. Then we simulated our model (\ref{eq.AR1}) and estimated parameters of the outcome bivariate population-copula, with last $500$ simulated points for each habitat patch (see Fig. \ref{fig_Cause4copula_params_GOF_500}). We also tested the goodness of fit of the estimated parameters for the population-copula and its standard error due to sample size. We reported p-values from goodness of fit tests for both statistics (Cramer-von Mises and Kolmogorov-Smirnov). p-values greater or equal to $0.05$ (above the dashed line in Fig. \ref{fig_Cause4copula_params_GOF_500}) were considered as a good fit of estimated parameters. Fig. \ref{SM-fig_Cause4copula_params_GOF_2500} represents similar feature as of Fig. \ref{fig_Cause4copula_params_GOF_500} but here we considered last $2500$ simulated population data points for our parameters-estimation, thus making our comparison more sensitive on basis of p-value threshold at $0.05$. (For code see [`Plotter_Cause4copula_GOF`](https://github.com/sghosh89/BIVAN/blob/master/Cause4copula.R) function). 

\begin{figure}[!h]
\begin{center}
\includegraphics[width=16 cm]{./Results/Cause4copula_results/compare_params_pGOF_num_keep_last_500.pdf}
\caption{Results of comparison between the parameters of environmental noise generated from a specific family of copula and estimated sample parameter (with some standard error) of the affected populations (Initially 5000 points are generated but we kept last 500 points for both noise and population data for comparison). p-values $> 0.05$ (above horizontal dashed line) indicate good fit (not significantly different) of population copula with same noise copula family. \label{fig_Cause4copula_params_GOF_500}}
\end{center}
\end{figure}
--> 

\begin{figure}[!h]
\begin{center}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_CorlmCoru_Kendall's Tau.pdf}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_PlmPu_Kendall's Tau.pdf}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_D2umD2l_Kendall's Tau.pdf}
\caption{Linear regression between 3 non-parametric stats ($\cor_l - \cor_u$, $\Ps_l - \Ps_u$ and $\Dsq_u - \Dsq_l$) of environmental noise generated from lower tail dependent Clayton copula and of the affected populations for 9 equidistant Kendall's Tau values in a range (0.1 to 0.9 as shown in Fig. \ref{SM-fig_Cause4copula_C_kend_ar1}) showed significant pearson correlation, and henceforth confirmed asymmetric tail dependence in noise copula caused similar tail dependence in population copula for AR(1) model. Regression line (black) differing from 1:1 line (green) indicates that asymmetric tail dependence in noise and population copulae are similar but not exactly the same.\label{fig_Cause4copula_scatter_C_kend_ar1}}
\end{center}
\end{figure}


To explore the effect of asymmetric sensitivity, we simulated our model (\ref{eq.AS}) for $b=0.1$ , $a=0.2$, $r=0.8$. $10000$ points were generated and we kept only the last $1000$ points to plot the population-copula (Fig. \ref{fig_ms_asym_b_0.1}) for each specific functional form of $g$  (For code see [`Simulator_asym_sens`](https://github.com/sghosh89/BIVAN/blob/master/asym_sensitivity.R) function). When asymmetric global noise had only non-positive contributions at two habitat patches ($g_{1}$ in the first panel of Fig. \ref{fig_ms_asym_b_0.1}), lower tail dependence appeared in the global noise copula and so thus in affected population copula (last subplot in the first panel of Fig. \ref{fig_ms_asym_b_0.1}). Similarly, when global noises had only non-negative contributions at two habitat patches ($g_{2}$ in the second panel of Fig. \ref{fig_ms_asym_b_0.1}), upper tail dependence appeared in the global noise copula and so thus in the outcome population copula (last subplot in the second panel of Fig. \ref{fig_ms_asym_b_0.1}). We also carried out model selection and non-parametric statistical analysis with each copula of Fig. \ref{fig_ms_asym_b_0.1} and summarized our results in Tables \ref{SM-tab_summary_stat_asym_sens} - \ref{SM-tab_stat_npa_asym_2}. According to our model selection approach (Table \ref{SM-tab_summary_stat_asym_sens}), non-normal copulae (with higher AIC weights) were always best-fit with similar asymetric tail dependence which gave the support of our hypothesis of the effect of asymmetric global noise copula on populations. Our non-parametric analysis results (Tables \ref{SM-tab_stat_npa_asym_1} -\ref{SM-tab_stat_npa_asym_2}) were consistent with the model selection approach. 

\begin{figure}[!h]
\begin{center}
\includegraphics[width=15 cm]{./Results/asym_sens_results/a_0.2_b_0.1_r_0.8_asym_sens.pdf}
\caption{Effects of asymmetric global noise copula (resulting from the asymmetric dependence of $g$ on $\varepsilon$) on two habitat patch model (Eq. \ref{eq.AS}) with growth rate $b=0.1$: copula of two populations ($P_{1}, P_{2}$) shaped according to the asymmetry of noise copula\label{fig_ms_asym_b_0.1}}
\end{center}
\end{figure}

<!--We now know the copula structure of environmental variables can induce (sometimes similar but not the same) copula structure in the populations, but we don’t really know how a change in the environment copula structure would make what kind of change in the population copula structure.--> 
<!--
## Application : The Moran effect and copula structure in population 

```{r read_RES_temp_aphid, echo=F}
RES_temp_aphid<-readRDS("./Results/fitting_results/AphidCopulaFit_selecloc_winter_neg_temp.RDS")
```

Firstly, Our hypothesis was if a non-normal copula structure describes the dependence of an environmental
variable between two locations, then there can be a non-normal copula structure for the
dependence of populations in the locations that are influenced by the environmental variables. This assumption was inspired by the the idea of Moran-effect [@Moran1953] which was originally used to explain synchronization of widely dispersed populations. In the previous section, we already tested our hypothesis with a two habitat patch model (1st order AR method) in noisy environment (having non-Normal copula structure) and found that populations were shaped by similar copula structure as that of local noises. Here, we investigated the probable cause of upper tail dependence in the leaf-curling plum aphid's firstflight date throughout all the locations. We assumed that average winter temperature which might be spatially synchronized and had asymmetric tail dependence cause the synchronized delay in leaf-plum curling aphid's appearence. We tested our hypothesis and indeed found the Moran effect on leaf-plum curling aphid's firstflight data induced by average winter temperature for the period of 35 years (1976-2010). We did pair wise model selection with negative average winter temperature (averaged over (n-1)$^{th}$ December to n$^{th}$ March temperature) from the selected 10 locations for which we did model selection with aphid-firstflight data. Negative winter temperature was considered for simulation to compare the aphid's firstflight results with temparature copula (aphid's firstflight date were negatively correlated with temperature or in other words positively correlated with negative temparature). Model selection results for negative average winter temperature in 10 $\times$ 10 matrices were represented in Table \ref{SM-tab_temp_aphid_bestcop} - Table \ref{SM-tab_temp_aphid_LTmUT}. In all cases `r min((RES_temp_aphid$gfc_numBS_success/RES_temp_aphid$gfc_numBS),na.rm=T)*100` $\%$ of bootstrap randomizations used for goodness of fit tests successfully lead to values of the statistic for comparison with its value on the real data. Table \ref{SM-tab_temp_aphid_LTmUT} showed `r sum(RES_temp_aphid$LTdep_AICw - RES_temp_aphid$UTdep_AICw <0, na.rm=T)` out of `r (dim(RES_temp_aphid$gfc_p_CvM)[1]^2-dim(RES_temp_aphid$gfc_p_CvM)[1])-2*RES_temp_aphid$num_indep_loc_pair` location pair showed upper tail dependence in temperature copula, which can be considered as the Moran effect results causing dominant upper tail dependence in the copulae with aphid's firstflight date (Table \ref{SM-tab_ff_LTmUT}). -->

### Need to think about mechanisms for biogeochemical, evolutionary, and community data

<!--Question 3 analyses-->
# Concepts, methods and models for Q3: Consequences of non-normal copula structure and tail dependence for our understanding of biology \label{Consequences}

This section is dedicated to analysis of question \hyperref[Intro]{\textbf{(Q3)}} from \nameref{Intro}. We wanted to examine whether the asymmetric tail dependence had any **(i)** effects on skewness of spatially averaged time series data. We predicted that because of overall distinct tail dependence of the multivariate copula structure, the skewness of the spatially-averaged time-series data, should change significantly from the individual skewness of time-series data. We tested null hypothesis $(H_{0})$ which presumed that multivariate copula actually came from normal copula structure with no tail dependence and thus should have the same skewness as of normal copula.
We generated $10000$ number of surrogate normal copula from a given multivariate copula keeping the marginal distribution and the correlation (spearman or kendall) same and calculated the skewness of spatially averaged surrogate time series data, as we did with the actual multivariate data set in the next section (For code see [skewness_multivar_dataset.R](https://github.com/sghosh89/BIVAN/blob/master/skewness_multivar_dataset.R)). We made a histogram of surrogate skewness and found if actual skewness was within the $95\%$ confidence interval or not. If the $p$-value is less than $0.05$, then we reject the null hypothesis in support of significant tail dependence (and henceforth significantly different skewness than Normal copula).

We also showed **(ii)** asymmetric copula structure affected slope of spatial Taylor's Law differently than as expected from symmetric Normal copula (For details see Appendix \ref{SM-Consequence_TL_simulation}). For example, our model simulation showed lower tail dependent Clayton copula had much higher slope (spatial-Taylor's law) than symmetric Normal copula, which in turn had higher slope than upper tail dependent Survival Clayton family (Fig. \ref{SM-fig_spTL}(I)). In the following section we will show application of these ideas with real datasets.
<!-- Extinction risk results are not shown currently, it is introduced as a future idea in Discussion-----------
Finally, we studied **(iii)** the effects of environmental noise, having a non-Normal copula, on extinction risk (calculated after 25 years) with two metapopulation model, namely, Lewton-Cohen model and Ricker model (For details see Appendix \ref{SM-Consequence_ext_risk}). We considered patches were arranged in a linear chain fashion and the population may disperse to its nearerst two neighbors (local dispersion) or to any patches (global dispersion). For both model with both dispersion, increasing number of habitat patches and increasing carrying capacity, separately, had decreased extinction risk of the populations which was expected (Fig. \ref{SM-fig_risk_numlocs_effect_local_disp} - Fig. \ref{SM-fig_risk_K_effect}). For Lewton-Cohen model, we found greater extinction risk if populations were affected by left tail dependence environmental noise copula than right tail dependent one. For Ricker model, we got the similar observation for smaller values of $r$, the intrinsic growth rate, but for higher values of $r$, there was a turn-over in extinction risks, and right tail dependent noise copula caused population go extinct faster. -->

\begin{figure}[!h]
\textbf{ \hspace{6 cm} (A) \hspace{6 cm} (B)} \\
\vspace{-0.1 cm}
\begin{center}
\includegraphics[width=5.5 cm]{./Results/skewness_results/skewness_aphid_count/skewness_aphid_count_sp_10_spearman.pdf}
\includegraphics[width=5.5 cm]{./Results/skewness_results/skewness_aphid_ff/skewness_aphid_ff_sp_11_spearman.pdf}\\
\end{center}
\vspace{0.2 cm}
\textbf{ \hspace{6 cm} (C) \hspace{6 cm} (D)} \\
\vspace{-0.1 cm}
\begin{center}
\includegraphics[width=5.5 cm]{./Results/skewness_results/skewness_plankton_north_sea/skewness_plankton_north_sea_sp_16_spearman.pdf}
\includegraphics[width=5.5 cm]{./Results/skewness_results/skewness_methane/skewness_methane_spearman.pdf}
\caption{Skewness of spatially averaged $(A)$ green-spruce aphid abundance, $(B)$ leaf-curling plum aphid firstflight date, $(C)$ Ceratium furca abundance and $(D)$ methane-flux data, were indicated by red dot in each plot and were compared with respect to skewness of spatially averaged 10000 Normal surrogates preserving Spearman correlation). \label{fig_skewness_spearman}}
\end{center}
\end{figure}

## Results for \hyperref[Intro]{\textbf{(Q3)}}: Change of skewness

We used our four multivariate datasets : aphid-count data, aphid-firstflight data, plankton data and methane-flux data, to compute skewness of spatially averaged data. We carried out the analysis mentioned in the concepts above, with aphid abundance and aphid firstflight date data for all 20 aphid species and plankton abundance data for all 22 plankton species. In each study, we got $>5\%$ positive results which gave us confidence in validating significantly different skewness for asymmetric copula than Normal. For example, Figure \ref{fig_skewness_spearman} represents the results for each dataset with Spearman correlation preserving surrogates. Figure \ref{fig_skewness_spearman}(A) showed that averaged skewness (indicated by red dot) was much lower than expected if the green-spruce aphid count data came from a normal copula. In that example, $p$ value was denoted by the fraction of surrogate-skewness which were lower than the averaged skewness of the given data. As $p<0.05$, we rejected $H_{0}$ in support of significantly stronger lower tail dependence which was also consistent with the non-parametric analysis and model fitting results (see first column of Table \ref{tab_multivar_summary}). On the other hand, Figure \ref{fig_skewness_spearman}(B) demonstrated that averaged skewness was significantly higher than expected if the leaf-plum curling aphid first flight data came from a normal copula, which was also confirmed by upper-tail dependence results from model selection and non-parametric results (see second column of Table \ref{tab_multivar_summary}). Figure \ref{fig_skewness_spearman}(C) showed that averaged skewness was lower than expected if the plankton data came from a normal copula. Our previous results on non-parametric analysis and model fitting also supported lower tail dependence (see third column of Table \ref{tab_multivar_summary}). But, as $p>0.05$, we could not reject $H_{0}$ in that case. Finally, for methane-flux data, the averaged skewness was found significantly lower in comparison to its Normal surrogates (Figure \ref{fig_skewness_spearman} D). We found the same result with all datasets when we repeated our simulation with Kendall correlation preserving surrogates (see Fig. \ref{SM-fig_skewness_kendall}).


## Results for \hyperref[Intro]{\textbf{(Q3)}}: Change of curvature of spatial Taylor's law regression line

```{r read_tl_aphid_count_sp6, echo=F}
tlsp6<-readRDS("./Results/taylorslaw_results/tl_aphid_count_sp6.RDS")
```

Spatial Taylor's law, the observed linear relationship between `log`(variance) and `log`(mean) of population densities of a species from different locations, is a well-known pattern found in ecology and related fields [@Taylor1961, @Taylor1988, @Cohen2013, @Doring2015, @Kuo2016, @Xu2016, @Reuman2017]. We already showed through simulation (Appendix \ref{SM-Consequence_TL_simulation}) that for asymmetric copula this linear relationship somehow deviates compared to Normal copula for a distribution with gamma marginals. We tested spatial Taylor's law with aphid count data (for all 20 species) and found that the mean curvature of the regression line from `log`(variance) vs. `log`(mean) of population abundance data was significantly different from $10000$ Normal surrogates (Spearman-correlation and marginal distribution preserving) for $25\%$ of total species considered. For example, the "Corn leaf aphid" (having significantly upper tail dependence from model selection and non-parametric analysis) showed mean curvature of regression line close to zero, whereas `r 10000 -(tlsp6$p_left_mncurv*10000)` of the $10000$ Normal surrogates showed higher curvature, indicating here Normal copula didn't hold linear relationship between `log`(spatial variance) and `log`(spatial mean) (see Fig \ref{fig_sTL_mncurv_sp6}). 

\begin{figure}[!h]
\textbf{ \hspace{4 cm} (A) \hspace{4 cm} (B) \hspace{4 cm} (C)} \\
\vspace{-0.5 cm}
\begin{center}
\includegraphics[width=10 cm]{./Results/taylorslaw_results/aphid_count_sp6_logv_vs_logm.pdf}
\includegraphics[width=5 cm]{./Results/taylorslaw_results/aphid_count_sp6_sTL_mncurv.pdf}\\
\caption{log(spatial variance) and log(spatial mean) for $(A)$ corn-leaf aphid (\textit{Rhopalosiphum maidis}) abundance and for $(B)$ one of the $9961$ Normal surrogates (having same marginal distribution and Spearman correlation of actual data). $(C)$ Histogram of mean curvature of $10000$ normal surrogates showed that for corn-leaf aphid abundance data (with asymmetric tail dependence), Normal surrogates didn't follow linear relationship between log(spatial variance) and log(spatial mean). \label{fig_sTL_mncurv_sp6}}
\end{center}
\end{figure}

# Discussion \label{Discussion}

<!--what we did and why is it important to study?-->

Most studies in ecology have focused on measuring correlations between variables and thus ignoring the possibility to recognize importance of stronger association between extreme values. In the present study, we introduced the concept of asymmetric tail-dependence and non-Normal copulae in this field. We showed by examples of several real data sets (Table \ref{tab_bivar_summary} and Table \ref{tab_multivar_summary}) that non-Normal copulae with specific tail dependence are common in nature and could tell us about the nature of interaction between different ecological variables. We applied two methods. First, we did a model selection approach based on maximum likelihood which fit the real copula data with an optimal set of 16 copulae family. Copula having highest AIC-weight came as best-fit from this approach. Though we did goodness of fit test based on two statistics (Cramer-von Mises and Kolmogorov-Smirnov), we wanted to ensure the reliability of our model selection results. So, on a second note, we measured the tail dependence at both lower and upper end of a copula by three different non-parametric statistics ($\cor$, $\Ps$ and $\Dsq$) which we defined and we found they were consistent with the inferences we drew from model selction results. Our approach could help to interpret the synchronous behavior of a species from several metapopulations. To illustrate, if pairwise copulae from a multivariate spatial data of a species (e.g. abundance data of green-spruce aphid) showed major "lower-tail dependence" on most of the locations then it could be considered as a signature of "spatial synchrony" that metapopulations are simultaneously rare at those locations. Conversely, if some aphid species showed synchronously "upper-tail dependence" then it would be harmful for corp-production or in case of synchronous abundance of plankton could lead to algal-bloom in the ocean. Copulae could also give us information about the causal relationship between ecological variables. For example, if maximum railfall is beneficial for some species then it would show an upper-tail dependent copula where high values of species abundance and precipitation would be more strongerly correlated than lower values. 

We explained the possible causes which induced asymmetric tail-dependence in the copula. Borrowing the idea from "Moran's theorem", we demonstrated with simulations that two habitat patches when affected by bivariate noise with an asymmetric copula structure showed similar tail-dependence asymmetry in the population copula from those patches (see Fig. \ref{fig_Cause4copula_params_GOF_500} and Fig. \ref{fig_Cause4copula_scatter_C_kend}). We also showed the effect of global environmental fluctuation (behaving asymmetrically beyond a certain threshold) on the meta-population copula which was shaped with similar tail dependence as the initial global noise copula (Fig. \ref{fig_ms_asym_b_0.1}). We observed significant changes in skewness of spatially averaged timeseries and also in the curvature of spatial Taylor's law for copula having asymmetric tail-dependence than would have been expected for Normal copula. For example, Fig. \ref{fig_skewness_spearman}(A) showed green spruce aphid abundance timeseries had right skewed distribution but its skewness was signifiantly lower than was expected if it came from Spearman correlation preserving Normal surrogates. This result indicates less extreme outbreaks of green spruce aphid around UK than it would have been with Normal copula structure. Similarly, methane fluxes showing lower skewness than Normal surrogates mean that the high emmisions are un-correlated between locations and monitoring this skewness over several decades may be helpful to understand the "green-house effect" on environment. 

<!--future work-->
We think this copula approach have scope to investigate into the extinction risks of metapopulation due to climate change. To illustrate, lower-tail dependent environmental fluctuations may suppress the metapopulations synchronously by making some of the habitats go extinct. This could help in managing policy for conservation of endangered populations.  


\clearpage

# References


