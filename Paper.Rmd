---
title: "The importance of a complete statistical description of dependence between variables for ecology and related fields"
author: "Shyamolina Ghosh, Lawrence W. Sheppard, Mark T. Holder, Terrance E. Loecke, Philip C. Reid, James D. Bever, Daniel C. Reuman"
date: ""
geometry: "left=1.5cm,right=1.5cm,top=2.5cm,bottom=2.8cm"

output: 
  pdf_document:
    number_sections: no
    keep_tex: yes
    fig_caption: yes
    includes:
      in_header: head_maintext.sty
      
tables: True
link-citations: True
urlcolor : blue
indent : True

csl: ecology-letters.csl
bibliography: REF_ALL.bib
---

updated on `r Sys.Date()`

```{r setup_Paper, echo=F}
knitr::opts_chunk$set(echo = TRUE, fig.pos = "H")
options(scipen = 1, digits = 5) #This option round all numbers appeared in the inline r code upto 5th digit
#seed<-101
#source("mtime.R") #A function needed for caching
```

# Front matter

*Affiliations:*

Ghosh: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

Sheppard: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

Holder: Department of Ecology and Evolutionary Biology and Biodiversity Institute, University of Kansas, Lawrence, KS, 66045, USA

Loecke: Environmental Studies Program and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA

Reid: School of Biological & Marine Sciences, University of Plymouth, Drake Circus, Plymouth PL4 8AA, United Kingdom
 
Bever: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66045, USA

Reuman: Department of Ecology and Evolutionary Biology and Kansas Biological Survey, University of Kansas, Lawrence, KS, 66047, USA; Laboratory of Populations, Rockefeller University, 1230 York Ave, New York, NY, 10065, USA 

*Possible alternative titles:*

- A complete statistical description of dependence between variables for ecology and related fields

*Keywords:*

*Type of Article*

- Ideas and Perspectives

*The number of words in the abstract*

*The number of words in the main text (excluding abstract, acknowledgements, references, table and figure legends)* 

*The number of words in each text box*

*The number of references*

*The number of figures, tables, and text boxes*

*The name and complete mailing address (including telephone and fax numbers and e-mail address) of the person to whom correspondence should be sent* 

\newpage
# Abstract

All branches of ecology study relationships among environmental and biological variables. However, ubiquitously used approaches to studying such relationships, based on correlation and regression, provide only a small slice of the complex information content of the relationships. Other statistical tools exist that provide a complete description of relationships, based on the concept of the *copula*; they are applied in finance, neuroscience and other fields, but not in ecology. We here examine the potential for copula approaches to improve our understanding of ecology. We find that informative copula structure in dependences between variables is exceedingly common across all the environmental, species-trait, phenological, population, community, and ecosystem functioning dataset we considered. Many datasets exhibited asymmetric tail dependence, whereby two variables are more strongly related in their left compared to right tails, or vice versa. Copula structure and tail dependence can help reveal causal relationships between variables. We describe two mechanisms by which observed copula structure and tail dependence can arise in ecological data: a Moran-like effect whereby dependence structures between environmental variables are inherited by ecological variables; and asymmetric or nonlinear influences of environments on ecological variables, such as under Liebig's law of the minimum. We describe consequences of copula structure, including impacts on extinction risk and the stability through time of ecosystem services. By documenting the importance of a complete statistical description of dependence, advancing conceptual frameworks, and demonstrating powerful methods, we aim to elevate copula approaches to widespread use in ecology.

\newpage
# Introduction \label{Intro}

Very generally, all branches of ecology and related areas <!--DAN : Reid said " Is this text needed. 
Ecology covers 
all branches of the biological sciences?
What do you mean by related areas? 
You use related fields later.
Needs clarifying."-->
study relationships among environmental and biological 
variables. However, commonly used correlation and regression 
approaches to studying 
such relationships are limited - such statistical
approaches provide only a very partial description of a relationship between variables. 
For instance, datasets showing markedly different 
relationships may nevertheless have the same correlation coefficient value 
(Fig. \ref{fig_cop_pedag1}A-B). The variables of Fig. \ref{fig_cop_pedag1}A 
(respectively, Fig. \ref{fig_cop_pedag1}B) are principally 
related in the left (respectively, right) portions of their distributions, an asymmetric 
pattern of dependence that may
have ecological significance, as discussed below, but is not captured by 
correlation. Panels C and D 
were obtained from A and B through monotonic transformation 
(Appendix \ref{SM-pedagog1_details} for details),
which alters the Pearson, but not the Spearman correlation. Although correlation
is only one of numerous metrics for 
studying relationships between variables, other common metrics <!--DAN : add example--> also 
provide only partial information.

\begin{figure}
\begin{center}
\includegraphics[width=3.5in]{./Results/PedagogFig1.pdf}
\caption{(A-F, I, J) Bivariate datasets showing diverse relationships between 
variables; many of these datasets nevertheless have the same Pearson (P)
or Spearman (S) correlation coefficients. Panels C and E (respectively, D and F) were 
obtained from A (respectively, B) via monotonic functions that transformed the 
standard-normal marginal distributions of A and B to gamma (C, D) or 
uniform (E, F) marginals (details in Appendix \ref{SM-pedagog1_details}). (G, H) Contours 
of log-scale density functions of Clayton (G) and survival-Clayton 
(H) copulas with parameter 5 (see section on methods for Q1). (I,J) Reflections
of E, F, respectively, about a vertical axis. Subscripts h and v 
stand for "horizontal" and "vertical". \label{fig_cop_pedag1}}
\end{center}
\end{figure}

Other well-developed statistical tools exist, that are 
applied widely in other fields (e.g. finance, neuroscience, bioinformatics etc.), 
and provide a demonstrably complete 
description of the dependence 
between two or more variables [@joe2014_dependence; @nelsen2006_copula]. 
The goal of this paper is to illustrate the potential for 
broader application of these
tools in ecology and related fields. The tools are based on 
the statistical concept of the *copula*, which we here 
introduce. Copula approaches separate the information contained in a bivariate 
random variable into two distinct parts: the information contained in the 
marginal distributions (which says nothing about the dependence between the 
variables), and the remaining information (which is solely about
the dependence between the variables). From a data perspective, given 
a sample $(x_i,y_i)$, $i=1,2,\ldots,n$ (e.g., 
Fig. \ref{fig_cop_pedag1}A-B), the associated dependence
or copula structure is revealed by the bivariate plot of $u_i$ versus $v_i$, where
$u_i$ is the rank of $x_i$ in the set of the $x_j$ ($j=1,\ldots,n$), divided by
$n+1$; and $v_i$ is defined in the same way but using the $y_i$. See, 
for instance,
Fig. \ref{fig_cop_pedag1}E-F, which show the copula structure of 
A-B, respectively. Ranking makes marginals of 
the underlying random variables uniformly distributed, isolating the 
dependence structure only<!--DAN : check this-->.
Mathematically, if $(X,Y)$ is a continuous bivariate random
variable and the cumulative distribution functions (cdfs) of $X$ and $Y$ are 
$F_X(x)=P[X\leq x]$ and $F_Y(y)=P[Y\leq y]$, then the dependence or copula structure
of $(X,Y)$ is revealed by the random variable $(F_X(X),F_Y(Y))$.
This random variable takes values in the unit square, 
$[0,1] \times [0,1]$, and has uniform marginal distributions. Probability density 
functions (pdfs) corresponding to the copulas associated 
with Fig. \ref{fig_cop_pedag1}E-F are in Fig.
\ref{fig_cop_pedag1}G-H, respectively. 
See @nelsen2006_copula and @joe2014_dependence
for general background. A theorem of A. @sklar1959_theorem
states that copulas give a unique and complete 
representation of the dependence
between variables, in the sense that the joint distribution of $(X,Y)$ 
can be reconstructed from the 
copula and the marginal distributions. 
Copula theory is also well developed for
multivariate distributions [@joe1997multivariate].

A principal benefit of a copula approach is 
that it can sensitively detect and model
tail dependence and asymmetries of tail dependence. 
Tail dependence is association between extreme values of variables. 
If smaller values of two positively associated variables are more 
strongly associated than are larger values, the variables are said to
have stronger lower- or left-tail dependence than right- or upper-tail dependence
(Fig. \ref{fig_cop_pedag1}A, E);
and \emph{vice versa} if larger values are more strongly associated than smaller
ones (Fig. \ref{fig_cop_pedag1}B, F). Datasets of the same 
correlation can have a range of tail dependence 
characteristics (Fig. \ref{SM-fig_cop_pedag}), which can be quantified (see section on
methods for Q1).

One way we may expect a copula approach 
to better reflect ecological relationships relates to Liebig's law of the
minimum. If, for instance, the growth of a plant depends on soil 
nitrogen, N, as well
as on other factors, a plot of plant growth rates versus soil nitrogen may be 
expected to look more like Fig. \ref{fig_cop_pedag1}A or E than like 
Fig. \ref{fig_cop_pedag1}B or F. Nitrogen 
will control plant growth, producing a clear
relationship, only when it is limiting, in the left portion of the N and 
plant-growth-rate distributions. 
Nitrogen will be less related or unrelated to growth rates in the right tails of 
the distributions, as in Fig. \ref{fig_cop_pedag1}A and E. The portion
of the distributions that dominate the association is visible in the copula
approach, but not via standard techniques.

A second reason we may expect a copula-based approach to benefit 
ecological research is that such an approach may help illuminate 
the causal mechanisms by which variables are related. For instance, if two species
X and Y are strong competitors, we may expect abundances of the two species
across quadrats to be negatively related, as in 
Fig. \ref{fig_cop_pedag1}I-J. If X is plotted on the horizontal axis
and Y is plotted on the vertical, then the plot in Fig. \ref{fig_cop_pedag1}I 
suggests X is the dominant 
competitor: when X is abundant, Y is necessarily rare because it is suppressed 
by X; whereas when X is rare, Y
may be abundant, or may also be relatively rare due to 
limiting factors other than X. 
Alternatively, Fig. \ref{fig_cop_pedag1}J suggests that Y
is the dominant competitor. The copula approach again reveals which portions of the
distributions are principally responsible for the association between variables, and this 
detail may help support or refute alternative causal hypotheses about 
the relationship between the variables.

A third reason we may expect a copula approach to benefit ecological
research is that prior work has demonstrated important copula 
stucture in the spatial dependence of environmental 
variables [@Serinaldi2008; @She2018; @Goswami2018;
@li2013]. One may expect copula structure in environmental variables 
to take the form of strong tail dependence if
intense meteorological events are also widespread in their effects, as seems 
frequently to be the case.
Spatial dependence in an environmental variable 
tends to beget dependence across space
in fluctuations of populations or other ecosystem variables 
(this is called \emph{spatial synchrony}) which are influenced by the environmental 
variable. This process is called the \emph{Moran effect}. 
If copula structure is transmitted, 
possibly in modified form, 
from environmental to ecological variables, then we may expect important 
copula structure to be a common feature of spatial synchrony of population, community, 
biogeochemical and other ecological variables.
Synchrony is a phenomenon of great interest in 
ecology [@Liebhold2004; @Sheppard2016; @walteretal2017].

A fourth reason we may expect copula structure to be important
in ecology has to do with spatially aggregated or averaged quantities. 
Many ecological variables of applied importance 
depend on the spatial average or sum of local 
quantities. For instance, regional methane and CO$_2$ 
fluxes are the sum of local fluxes; 
and the total economic value of a fishery is the sum of catches from 
local areas. We will explore how details, captured by copula methods, of the 
nature of the dependence between local quantities can influence the spatial 
mean or sum, and how this may influence human concerns and 
higher organizational levels in 
ecology. Illustrating the idea here, prior work demonstrated that the overall 
reliability of wind-generated electricity depends sensitively on details
of the dependence between wind speeds at multiple generator sites [@li2013]. 
Spatially aggregated ecological variables may show a similar dependence, with
potentially substantial consequences. For instance, if populations of a 
pest species in different locations are all positively associated and also strongly
related to each other in their right tails, then local outbreaks tend 
to occur together, creating regional epidemics. If populations
of a crop or other resource species are strongly 
related in their left tails, then 
episodes of local scarcity occur together, creating regional 
shortages. On the other hand left-tail dependence in the pest species 
or right-tail dependence in the crop, even if overall correlation were 
unchanged, would have much more benign effects.

We approached our overall goal of exploring the potential of 
copula approaches in ecology by addressing the 
following specific questions. (Q1) Do datasets in ecology and related fields 
have copula structure distinct from that of a Gaussian/normal distribution (here called 
non-normal copula structure)? Do they show tail dependence distinct from that 
of a normal distribution, and in particular do they show asymmetric tail 
dependence? (Q2) If so, what are some possible causes/mechanisms of this 
non-normal copula structure? And (Q3) what are the consequences of non-normal 
copula structure and tail dependence for our understanding of biology and for 
applications? To address Q1, we analyze several datasets, including 
environmental, species-trait, phenological, population, community, and 
ecosystem functioning data. We selected these datasets to span multiple 
sub-fields and organizational levels of ecology. The second section of the 
paper introduces the data, and the third and fourth sections use the data to 
address Q1. The fifth and sixth sections, which address Q2, use simple models to 
explore mechanisms. The seventh and eigth sections, which address Q3, use both
the data of section two as well as models to explore a variety of consequences
of copula structure and tail dependence for applications and for understanding
ecology. The ninth section is the Discussion. 
Copula approaches have been used to great benefit in neuroscience [@onken2009], 
bioinformatics 
[@Kim2008], medical research [@Emura2016], direct study of environmental 
variables [@Serinaldi2008; @She2018; @Goswami2018; @li2013], finance, and other fields. 
To our knowledge, these approaches have never or seldom been used for ecological research. 
We argue that benefits to ecology of using a complete statistical 
desription of dependence will be substantial.

# Data \label{Data} 

```{r read_somedata, echo=F, results='hide'}
d_soilCN<-readRDS("Data/dataForShymolinaCoord.rds")
d_soilCN<-na.omit(d_soilCN)
d_birdsBMR<-readRDS("./Data/BMR/BirdBodyMassesMetabolicRates/my_birdsBMR_data.RDS")
d_mammalsBMR<-readRDS("./Data/BMR/MammalianBodyMassesMetabolicRates/my_mammalsBMR_data.RDS")
d_cc<-readRDS("./Results/Ceder_creek_results/cop_HB_all_yr.RDS")
```

Datasets included environmental, species-trait, phenological, 
population, community, and ecosystem functioning data (Table \ref{tab_data_info}). Copula structure describing 
the relationship between atmospheric weather variables such as rainfall or wind speed 
as measured in multiple locations has been 
examined previously in the meteorological literature [e.g., @Serinaldi2008; @li2013]. We therefore 
examined environmental variables from the soil instead, using the Rapid Carbon 
Assessment database [RaCA; @Wills2014].
<!--***DAN: Add Wills and Loecke pending reference if published in time--> 
The database comprises measurements of soil organic carbon and total soil 
nitrogen (Mg C or N per hectare of soil surface) from `r nrow(d_soilCN)` 
locations across the coterminous United States (Fig. \ref{SM-fig_SoilCNmapUSA} for sampling locations).
Measurments were from the central pedon of a soil core, to 1 m depth.
Species-trait data were average species basal metabolic rate (BMR, KJ per hour) and 
body mass (grams) data for `r nrow(d_birdsBMR)`  species of birds [@Mcnab_2009] 
and `r nrow(d_mammalsBMR)`  species of mammals [@Mcnab_2008].
These data have been much studied, but to our knowledge the copula structure 
of the dependence between metabolic rate and body mass has not been examined. 
Species-trait data such as these reflect the coevolution of the two traits.
Phenological data were aphid first-flight dates from 10 locations (Fig. \ref{SM-fig_aphid_map}) 
across the United Kingdom (UK) for 20 aphid species (Table \ref{SM-tab_aphid_info}), for the 
35 years 1976 to 2010. These time series were computed from the Rothamsted Insect 
Survey (RIS) suction-trap dataset [@Harrington2014; @Bell2015]. The first of our two 
population-level datasets was also derived from the RIS suction-trap data, and comprised 
total counts of aphids trapped for the same locations, species, and years; these are 
indicators of aphid migration counts. Data pre-processing for the aphid data was the same as 
that of @Sheppard2016,
but we excluded one of the 11 sites they used in order to only use sites with at least 30 
years data.  Our second population dataset comprised average annual plankton abundance estimates 
for 14 locations (Fig. \ref{SM-fig_plankton_map})
in the North Sea and British seas for 22 taxa (Table \ref{SM-tab_plankton_info}) for the 
56 years 1958 to 2013. The locations are $2^\circ$ by $2^\circ$ grid cells. These data 
were obtained from the Continuous Plankton Recorder (CPR) dataset, now operated and maintained by 
the Marine Biological Association of the United Kingdom. Data pre-processing was similar but not identical to that 
of @Sheppard2017; see Appendix \ref{SM-Data_details} for details.
Community-level data, obtained from the Cedar Creek Ecosystem Science Reserve, were 
plant aboveground biomass and Shannon's diversity index for `r nrow(d_cc[[5]])` plots, each 9m by 9m, as sampled in 
the years 1996-2000 and 2007, each year analyzed separately [@Tilman2001; @Tilman2006]. 
Shannon's index was computed from plant species percent cover data.  
Finally, ecosystem functioning data were methane (CH$_{4}$) fluxes between the soil or 
water surface and the troposphere, measured at 13 locations at daily to weekly intervals 
from September 2015 to September 2016 at the Great Miami Wetland mitigation bank in Trotwood, 
Ohio [@Holland1999; @Jarecke2016; @smyth2019using]. Each included location was measured on at least 50 dates. 
Sampling locations spanned a hydrologic gradient from upland to seasonal wetland.
See Appendix \ref{SM-Data_details} for additional data details. 

The environmental, species-trait, and community datasets are henceforth 
called the "bivariate" datasets in the sense that they comprise two quantities measured at 
different locations or for different species. The phenology and population datasets are 
"multivariate" in that they comprise, for each taxon, measurements through time at multiple locations; 
copula structure can be studied for each pair of locations. Likewise the ecosystem 
functioning (methane flux) dataset was  multivariate in this sense (Table \ref{tab_data_info}).

<!--summary table with info of all data used in Paper-->
```{r tab_summary_data_info, echo=F, results="asis",message=F}
library(kableExtra)
library(dplyr)
tab_data_info<-as.data.frame(matrix(NA,nrow=8,ncol=4))
colnames(tab_data_info)<-c("Data","Category","No. of measurements we used", "References")
tab_data_info$Data<-c("Soil C and N","Bird body masses and BMR", "Mammal body masses and BMR", "Cedar Creek data", 
                      "Green spruce and other aphid species abundances", "Leaf-curling plum and other aphid first flight dates","Ceratium furca and other plankton taxa abundances","Methane flux")
tab_data_info$Category<-c("Environmental","Species-trait","Species-trait","Community level",
                          "Population","Phenological","Population","Ecosystem functioning")
tab_data_info$`No. of measurements we used`<-c(paste(nrow(d_soilCN)," locations",sep=""),
                                               paste(nrow(d_birdsBMR)," birds",sep=""),
                                               paste(nrow(d_mammalsBMR)," mammals",sep=""),
                                               paste(nrow(d_cc[[5]])," plots",sep=""),
                                               "10 locations with atleast 30 yrs. of timeseries for each 20 sp.",
                                               "10 locations with atleast 30 yrs. of timeseries for each 20 sp.",
                                               "14 locations with atleast 45 yrs. of timeseries for each 22 taxa",
                                               "13 locations with atleast 50 dates of data")
tab_data_info$References<-c("US Rapid Carbon Assessment database (RaCA), Wills et al. (2014)", "McNab (2009)","McNab (2008)",
                            "Cedar Creek Ecosystem Science Reserve, biodiversity experiment e120",
                            "Rothamsted Insect Survey","Rothamsted Insect Survey","Continuous Plankton Recorder Survey",
                            "Great Miami Wetland Mitigation Bank, Smyth et al. (2019)")

knitr::kable(tab_data_info, 
             format="latex", align="l",
             caption = "Summary table for the data we used. Bolds entries are the multivariate data, the rest are bivariate datasets (see Data section). Basal metabolic rate=BMR \\label{tab_data_info}", 
             booktabs = T,linesep = "\\addlinespace") %>%
             column_spec(1:4,width="2.8 cm")%>%
             row_spec(5:8, bold=T)
```

# Background, concepts and methods for Q1: Detecting copula structure in data \label{Methods}

To make results interpretable
to readers unfamiliar with copulas, we first introduce the normal copula and 
some other copulas we used; and we operationally introduce measures of tail dependence
and asymmetry of tail dependence. 
Conceptually, a bivariate copula is essentially a probability density function (pdf)
on the unit square with uniform maginals. 
Strictly speaking, 
the copula is actually defined as the bivariate 
cdf of the distribution rather than as the pdf,
but this makes little conceptual difference. 
The normal copula family is a one-parameter
family of copulas, with parameter corresponding to the correlation of the related 
bivariate normal distribtion, and controlling the degree of dependence 
(Fig. \ref{fig_cop_pedag3}A-B for an example).
Left- and right-tail dependence are $0$ for the normal copula, and this 
serves as a benchmark for tail dependence in other copulas - positive values of our
tail dependence measures correspond to dependence stronger than that of a normal
copula. The Clayton and 
survival-Clayton families (Fig. \ref{fig_cop_pedag1}G-H) are two more one-parameter 
families. The Clayton has positive lower-tail dependence ($0.87$ for
the example of Fig. \ref{fig_cop_pedag1}G) and $0$ upper-tail dependence; the 
survival-Clayton, which is a rotation of the Clayton by $180^\circ$, has 
positive upper-tail dependence ($0.87$ in Fig. \ref{fig_cop_pedag1}H)
and $0$ lower-tail dependence. For our model selection procedure (see below), we used 
several one- and two-parameter families of copulas exhibiting a wide variety of 
positive lower-tail dependence values 
(Clayton, survival-Gumbel, survival-Joe, survival-BB6, henceforth
abbreviated, respectively, C, SG, SJ, SBB6) and upper-tail dependence values
(survival-Clayton, Gumbel, Joe, BB6, henceforth abbreviated, respectively, 
SC, G, J, BB6). We also considered families that could exhibit positive upper- or lower-tail
dependence, or both, depending on parameters (BB1, survival-BB1, BB7, survival-BB7, henceforth 
abbreviated, respectively, BB1, SBB1, BB7, SBB7). 
If LT and UT are used to denote 
lower- and upper-tail dependence, their difference is a measure of asymmetry of 
tail dependence. We also used two families that were asymmetric in their non-tail parts, 
but that had zero tail dependence (BB8, survival-BB8, abbreviated BB8 and SBB8).
In addition to the normal copula, we used another symmetric copula,
the Frank copula (abbreviated F; Fig. \ref{fig_cop_pedag3}C-D). 
Copulas are implemented in the `copula` and `VineCopula` packages for the 
R statistical computing language.
Additional details are in introductory texts 
on copulas [@nelsen2006_copula ; @joe2014_dependence] and in `VineCopula` documentation.
Visualizations of the copulas we used are in Figs \ref{SM-figped_N}-\ref{SM-figped_SBB8}. 

\begin{figure}
\begin{center}
\includegraphics[width=3.5in]{./Results/PedagogFig3.pdf}
\caption{Log-transformed pdfs (A, C) and samples from (B, D) example copulas.
Shown are the normal copula with parameter $0.8$ and the Frank copula with 
parameter $10$. See also Fig. \ref{fig_cop_pedag1}E-H for the Clayton and  
survival-Clayton copulas with parameter 5. Figs \ref{SM-figped_N}-\ref{SM-figped_SBB8}
have visualizations of all the copulas we used.\label{fig_cop_pedag3}}
\end{center}
\end{figure}

We addressed Q1 principally via a model selection procedure in which the normal copula
the alternative copulas listed above were fitted to 
our ecological datasets. The resulting fits of the various copula models 
were compared via the Akaike and Bayesian 
Information Criteria (AIC and BIC). For bivariate datasets 
$(x_i,y_i)$ for $i=1,...,n$, model selection involved several steps. 
First, as in the Introduction, we produced ranks 
$(\tilde{u}_i,\tilde{v}_i)$ where $\tilde{u}_i$ is the rank of $x_i$ in the set 
$\{x_i:i=1,...,n\}$ and $\tilde{v}_i$ is the rank of $y_i$ in the set $\{y_i:i=1,...,n\}$.
Ranks were $1$ for the smallest element in a set. We then 
set $u_i=\tilde{u}_i/(n+1)$ and $v_i=\tilde{v}_i/(n+1)$; subsequent analysis used these 
*normalized ranks* $u_i$ and $v_i$. 
Second, we did a test of the independence of the $u_i$ and $v_i$ 
(implemented in `BiCopIndTest` in the `VineCopula` package). 
Subsequent model 
selection algorithms are ineffective if data could not be distinguished from independent data 
since most or all bivariate copula families we considered include the independent copula in the 
family or as a boundary case. If independence could be rejected ($0.05$ significance level), model 
selection proceeded. Third, we fit the bivariate copula families listed previously to the ranked data 
$(u_i,v_i)$ via maximum likelihood, using the `BiCopEst` function in `VineCopula`, and 
obtained AIC and BIC values and accompanying model weights, $\text{AIC}_{\text{w}}$ and 
$\text{BIC}_{\text{w}}$ [@burnham2003_modelselection]. The weight of a model represents the 
relative support of data for the model; weights sum to 1 across models considered. The lower- and 
upper-tail dependence of the best-fitting member of each family was also provided by `BiCopEst`. 
Fourth, $\text{AIC}_{\text{w}}$ values for all fitted models were used to get
model-averaged lower- and upper-tail dependence values using standard model averaging 
formulas [@burnham2003_modelselection]; likewise for BIC.
Model selection methods will give the *relative* support of several models, but will not,
on their own, indicate whether any of the models selected are an objectively good fit: all 
models considered might poorly describe the data. To test this, and as the final step of
our procedure, we tested the goodness of fit of our AIC-best copula family using a 
bootstrapping procedure implemented in `BiCopGofTest` of `VineCopula`. The method performed 
two tests, one based on a Cramer-von Mises statistic, and one based on a 
Kolmogorov-Smirnov statistic. To keep computation times reasonable, 
an initial run using $100$ bootstraps was performed, and if
the $p$-value resulting from either test was less than $0.2$, tests were re-run with 
$1000$ boostraps.

The first part of Q1 was answered for a bivariate dataset 
by comparing the AIC weights of the non-normal copula
families with that of the normal family. 
The second part of Q1 was answered by comparing 
the model-averaged lower- and upper-tail dependence
values to the lower- and upper-tail dependence values of a normal copula (which 
are 0). The third part of Q1
was answered by comparing the difference of the model-averaged lower- and upper-tail 
dependence values to the analogous difference for a normal copula, again 0.
For multivariate datasets,
each of which consists of time series from multiple locations, we carried out the bivariate analysis
for all possible pairwise combinations of locations and compared AIC weights and tail-dependence of 
minimum-AIC copulas with that of the normal copula. We also counted the number of location pairs 
for which model-averaged lower-tail dependence was greater than model-averaged upper-tail dependence 
or vice-versa, and reported the percentage of pairs showing stronger lower-tail dependence out of 
the total number of non-independent location pairs considered.

In addition to our model selection approach, we also used nonparametric approaches to 
quantify lower- and upper-tail dependence and to answer Q1. Using two approaches can provide greater 
confidence in results. We used three nonparametric
statistics which can quantify the extent to which 
two normalized ranks $u_i$ and $v_i$ are 
related in any part of their distributions; we here describe the 
statistics operationally, with details in Appendix \ref{SM-nonparam_stats}.
The statistics were formulated with positively associated
variables in mind. All the variables we study were positively associated
when they were significantly associated. So definitions and associated 
diagrams will assume positive associations. Given two bounds 
$0 \leq l_b < u_b \leq 1$, we define the parallel lines $u+v=2l_b$ and 
$u+v=2u_b$, which intersect the unit square (Fig. \ref{SM-fig_stat_image}). 
Our statistics quantify the dependence
between $u_i$ and $v_i$ in the region bounded by these lines.
Using $l_b=0$ and some value $u_b\leq 0.5$ can give information about 
dependence in the left parts of the distributions of $u$ and $v$, and 
using $u_b=1$ and $l_b \geq 0.5$ can give information about dependence in 
the right parts of the distributions. The first statistic, denoted 
$\cor_{l_b,u_b}(u,v)$, is the portion of the Spearman 
correlation of $u_i$ and $v_i$ that is attributable to the points 
lying in the region given by the bounds.
Larger values of $\cor_{l_b,u_b}$ indicate stronger positive association
between $u$ and $v$ in the region.
We also defined a statistic $\Ps_{l_b,u_b}$ (Appendix \ref{SM-nonparam_stats}), 
which has a similar 
interpretation to $\cor_{l_{b},u_{b}}(u,v)$.
Our third statistic, $\Dsq_{l_b,u_b}(u,v)$, is the average squared 
distance between points satisfying $u_i+v_i>2l_b$ and 
$u_i+v_i<2u_b$ and the line $v=u$.

Unlike $\cor_{l_b,u_b}$ and 
$\Ps_{l_b,u_b}$, for which large values inidicate strong dependence
in the portions of the the distributions of $u$ and $v$ given by 
the bounds, small values of 
$\Dsq_{l_b,u_b}$ indicate strong dependence. 
For large datasets (large $n$),
we could use $l_b$ and $u_b$ close together without incurring undue
sampling variation in our statistics, and we could consider 
multiple bands $(l_b,u_b)$ to understand how dependence
varies in different parts of the distributions. But for datasets with 
smaller $n$ we considered only $l_b=0$, $u_b=0.5$ and $l_b=0.5$, $u_b=1$.
We use the shorthand $\cor_l=\cor_{0,0.5}$ ($l$ is for "lower") 
and $\cor_u=\cor_{0.5,1}$ ($u$ is for "upper"); likewise $\Ps_l=\Ps_{0,.5}$,
$\Ps_u=\Ps_{0.5,1}$, $\Dsq_l=\Dsq_{0,0.5}$, and $\Dsq_u=\Dsq_{0.5,1}$.
To test for asymmetry of dependence in upper and lower portions of distributions,
we used differences of upper and lower statistics: for smaller datasets, 
$\cor_l-\cor_u$, $\Ps_l-\Ps_u$ and $\Dsq_u-\Dsq_l$ (note the opposite order
in the last of these); for large datasets, $\cor_{0,u_b}-\cor_{1-u_b,1}$, 
$\Ps_{0,u_b}-\Ps_{1-u_b,1}$ and
$\Dsq_{1-u_b,1}-\Dsq_{0,u_b}$ (again note the opposite order) with $u_b$ close 
to $0$.
We tested our statistics in Appendix \ref{SM-Test_npa_stat} (see also Figs \ref{SM-fig_stat_testing35}-\ref{SM-fig_stat_testing1000}). 

# Results for Q1: Ecological datasets often have non-normal copula structure and asymmetric tail dependence \label{Results}

```{r read_BivMS_soilCN_data,echo=F}
d<-readRDS("Data/RaCA_soilorganicC_soiltotalN_stocks100cm.RDS")
d<-d[,c("SOCstock100","TSNstock100")] #raw soilCN data
BivMS_res_Loecke<-readRDS("./Results/fitting_results/BivMS_soilCN.RDS")
```

```{r read_RES_aphid_count, echo=F}
RES_aphid_count<-readRDS("./Results/fitting_results/AphidCopulaFit_selecloc_count_species_10.RDS")
```

\begin{figure}
\begin{center}
\includegraphics[width=6.5in]{./Results/BivarDataPlot.pdf}
\caption{Upper panels show raw data plots for (A) $\log_{10}$(soil C) and $\log_{10}$(soil N) data, (B) $\log_{10}$(basal metabolic rate (BMR)) vs. $\log_{10}$(body mass) 
for birds, (C) $\log_{10}$(BMR) vs. $\log_{10}$(body mass) for mammals, and (D) above-ground plant biomass vs. Shannon's index \textit{(H)} from Cedar Creek. Bottom panels show the corresponding copula plots. See text for units used in upper panels. \label{fig_biv_multi_raw_cop}}
\end{center}
\end{figure}

Across essentially all the sub-fields and levels of organization within ecology for which we 
examined a dataset, copula structures were typically non-normal and variables 
commonly exhibited asymmetric tail 
dependence. To make results easier to absorb for readers who are new to copulas: we first 
present results in detail for an example bivariate dataset; then we summarize results
for all bivariate datasets; then we present results in 
detail for an example multivariate dataset; then we summarize results 
for all multivariate datasets.

<!--bivariate example-->
We present the example of the soil C and N data (see Data), pictured in 
Fig. \ref{fig_biv_multi_raw_cop}A (raw data) and E (copula plot). The variables were 
non-independent ($p=$ `r BivMS_res_Loecke$IndepTestRes`, to within the precision available 
from `BiCopIndTest` in the `VineCopula` package); non-independence is also visually apparent
(Fig. \ref{fig_biv_multi_raw_cop}A,E).
The Kendall correlation was `r round(BivMS_res_Loecke$TauVal,2)`. We fitted the 16 copulas
mentioned in the previous section to the 
data pictured in Fig. \ref{fig_biv_multi_raw_cop}E; AIC and BIC weights and corresponding
lower- and upper-tail statistics for the fitted distributions were computed (Table \ref{SM-tab_soilCNfit}). 
`r BivMS_res_Loecke$InfCritRes$copname[which.max(BivMS_res_Loecke$InfCritRes$AICw)]` was the 
minimum-AIC copula, with AIC weight `r round(max(BivMS_res_Loecke$InfCritRes$AICw),2)`, whereas the 
normal copula had AIC weight essentially 0, answering the 
first part of Q1 for these data. 
The model-averaged lower- and upper-tail dependence statistics were `r round(BivMS_res_Loecke$relLTdep_AICw,3)` 
and `r round(BivMS_res_Loecke$relUTdep_AICw,3)`, respectively (AIC weights were used for model averaging). 
These values are distinct from what a normal copula would give, namely, 0, answering the second part 
of Q1 for these data. The values also differed substantially 
from each other, answering the third part of Q1. The numbers reflect stronger upper- than lower-tail
dependence for the soil C and N data, and this can also be seen visually in extreme upper-right
and lower-left corners of the copula plot (Fig. \ref{fig_biv_multi_raw_cop}E).

Although these results do convincingly show non-normal copula structure, 
we caution that the model-averaged tail-dependence statistics may have been biased 
because even the lowest-AIC copula 
(`r BivMS_res_Loecke$InfCritRes$copname[which.max(BivMS_res_Loecke$InfCritRes$AICw)]`) 
was a poor fit ($p=$ `r BivMS_res_Loecke$GofRes_CvM` and `r BivMS_res_Loecke$GofRes_KS` for the 
Cramer-von Mises and Kolmogorov-Smirnov goodness-of-fit tests, respectively, to within the precision 
available from `BiCopGofTest` in the `VineCopula` package). However, nonparametric statistics verified
both that tail dependence was distinct from that of an N copula for the soil data, and that it 
was asymmetric (Appendices \ref{SM-Q1bivarnonparam}, \ref{SM-surrog_test}, 
Fig. \ref{SM-fig_soilCN_nonparam}, Table \ref{SM-tab_soilCN_asym}). 


<!--bivariate summary-->
Table \ref{tab_bivar_summary} summarizes results for Q1 for the bivariate datasets. For all $4$ 
bivariate datasets, the two variables were always significantly related 
(Table \ref{tab_bivar_summary}, row 1). A non-normal copula 
always emerged as the lowest-AIC (highest-AIC-weight) copula 
(Table \ref{tab_bivar_summary}, row 2). 
The N copula was always a poor fit compared to the highest-AIC-weight copula 
(Table \ref{tab_bivar_summary}, rows 3-4), answering the first part of Q1. 
Lower- and upper-tail statistics (Table \ref{tab_bivar_summary}, rows 7-8) 
differed substantially from 0, the tail dependence statistics of 
the N copula, answering the second part of Q1; and also differed substantially from each other
(Table \ref{tab_bivar_summary}, row 9),
answering the third part of Q1. The first three datasets had stronger upper- 
than lower-tail dependence, and the last dataset had the reverse. 
Although these results convincingly show non-normal copula structure, the 
model-averaged tail-dependence statistics may have been biased 
because even the lowest-AIC copula was a poor fit in some cases 
(Table \ref{tab_bivar_summary}, rows 5-6).
But our nonparametric statistics confirmed the same conclusions 
(Appendices \ref{SM-Q1bivarnonparam}, \ref{SM-surrog_test}) for first three bivariate datasets.
The fourth bivariate datasets we analyzed was above-ground biomass and percent cover data (i.e. 
the data used to compute Shannon's diversity index) for the year 2000, but we did the same analysis 
with Cedar creek data sampled over 168 plots from other available years (1996-1999, 2007) too. For 1996 and 
2007 copula structures showed no dependence between two variables concerned, for other years (1997-1999), 
we found similar results as of year 2000 (i.e. best fit non-Normal copula and overall lower tail-dependence).
Due to smaller sample size relative to other three bivariate datasets, we chose a wider range with 
non-parametric analysis (Appendix \ref{SM-Q1bivarnonparam}). Detailed results for each dataset are in Tables \ref{SM-tab_soilCNfit} - \ref{SM-tab_cc_asym_2000} and Figs. \ref{SM-fig_soilCN_nonparam} - \ref{SM-fig_cc2000_nonparam}. 

We present our analysis of the green spruce aphid abundance data (see Data)
as an example multivariate analysis.
Independence was tested for each pair of the 10 sampling locations, and was 
rejected in every case. 
Model selection among copulas was carried out separately for each pair of locations.
Best-fitting (lowest-AIC) copulas were non-normal
for the large majority of location pairs (Table \ref{SM-tab_count_bestcop}), and 
AIC weights for the best-fitting copulas (Table \ref{SM-tab_count_AICw}) 
were typically substantially 
larger than those for the N copula (Table \ref{SM-tab_count_AICw_normal}), answering 
the first part of Q1 from the Introduction for these data.
Goodness of fit tests based on Cramer-von Mises or Kolmogorov-Smirnov statistics 
(Tables \ref{SM-tab_count_p_CvM}, \ref{SM-tab_count_p_KS}) in every case 
failed to reject the hypothesis that the AIC-best copula family was also 
an objectively adequate description of 
the data, demonstrating that the collection of 
copula families we used was sufficiently broad that the copulas of all pairs of 
locations could be characterized by at least one of them.
Model-averaged lower- (Table \ref{SM-tab_count_LTdep_AICw}) and upper-tail
(Table \ref{SM-tab_count_UTdep_AICw}) dependence statistics were exclusively 
positive and were frequently substantially large, thereby differing 
from what an N copula would give (i.e., 0), and answering the second part of 
Q1 for these data. Apparently these aphid data have greater tail dependence 
(both lower and upper) than would be expected from an N-copula null hypothesis. 
Model-averaged lower-tail dependence statistics minus model-averaged 
upper-tail dependence statistics (Table \ref{SM-tab_count_LTmUT}) were positive 
for all but a few locations pairs (`r sum((RES_aphid_count$LTdep_AICw-RES_aphid_count$UTdep_AICw)>0,na.rm=T)` 
out of `r (dim(RES_aphid_count$gfc_p_CvM)[1]^2-dim(RES_aphid_count$gfc_p_CvM)[1])-2*RES_aphid_count$num_indep_loc_pair`), 
indicating that lower-tail dependence across space was much stronger than upper-tail 
dependence. Thus the spatial synchrony of rarity in green spruce aphid is stronger 
than the spatial synchrony of outbreak events. This also answers the third part of Q1.
Nonparametric statistics verified that tail dependence was asymmetric for the green 
spruce aphid abundance data (Appendix \ref{SM-Q1multvarnonparam}, \ref{SM-spatial_resamp}).

<!--multivariate summary-->
Table \ref{tab_multivar_summary} summarizes some of our results using our
multivariate data. In addition to summaries of the green spruce aphid abundance data results 
elaborated in detail above, the table also summarizes results for 
leaf-curling plum aphid first flight data, abundance data for the dinoflagellate
\textit{Ceratium furca}, and methane-flux data (see Data). Results supported the 
conclusions that non-N copula structure, non-N tail dependence, and asymmetric tail 
dependence were common. Most locations pairs were non-independent 
(Table \ref{tab_multivar_summary}, row 2). The large majority of non-independent location 
pairs had best-fitting copula that was not the N copula (Table \ref{tab_multivar_summary}, 
row 3), and AIC weights of best-fitting copulas were 
substantially better than AIC weights of N copulas (Table \ref{tab_multivar_summary}, rows 4-5).
For these data, best-fitting copulas were nearly always considered an adequate fit, 
according to Cramer-von Mises and Kolmogorov-Smirnov goodness of fit tests 
(Table \ref{tab_multivar_summary}, row 6). Some of the datasets (green spruce aphid
abundance, \textit{Ceratium furca} abundance, methane flux) showed stronger 
or marginally stronger lower- than upper-tail dependence 
(Table \ref{tab_multivar_summary}, rows 7-9), whereas leaf-curling plum aphid first flight
data showed the reverse. Asymmetry results were verified by nonparametric approaches 
<!--(e.g., Table \ref{tab_multivar_summary}, row 10)-->
(Appendix \ref{SM-Q1multvarnonparam}, \ref{SM-spatial_resamp}). Detailed results are in 
Tables \ref{SM-tab_count_bestcop}-\ref{SM-tab_methane_resamp} and 
Figs \ref{SM-fig_aphid_count}-\ref{SM-fig_methane}.
We also carried out the same analyses for abundance and first-flight data for the 18 
aphid species for which we had data other than the green spruce and leaf-curling plum aphids,
as well as for the 21 plankton taxa for which we had abundance data other than the
\textit{Ceratium furca} (results not shown). The conclusions were generally supportive that 
non-N copula structure and tail dependence, as well as asymmetry of tail dependence, are 
very common.

<!--summary table : results with bivariate data-->
```{r tab_bivar_summaryl, echo=F, results='asis',message=F}
tab_bivar_summary<-readRDS("./Results/tab_bivar_summary.RDS")
row.names(tab_bivar_summary)<-NULL
library(kableExtra)
library(dplyr)
library(tibble)

dt <- tibble(Description = c("1. p-value, independence test",
           "2. Minimum-AIC copula",
           "3. AIC weight of minimum-AIC copula",
           "4. AIC weight of N copula",
           "5. p-value, Cramer-von Mises goodness of fit test",
           "6. p-value, Kolmogorov-Smirnov goodness of fit test",
           "7. Model averaged lower-tail dependence",
           "8. Model averaged upper-tail dependence",
           "9. Model averaged lower- minus upper-tail dependence",
           "10. Asymmetry rank in surrogates")
)
tab_bivar_summary<-cbind(dt,tab_bivar_summary)
knitr::kable(tab_bivar_summary[1:9,], 
             format="latex",
             caption = "Summary of Q1 results for bivariate datasets. The $p$-values in rows 5-6 are for the minimum-AIC copula. Model averaging used for rows 7-9 was based on AIC weights.\\label{tab_bivar_summary}",
             booktabs=T, linesep = "\\addlinespace",
             col.names = c(" ", "Soil C and N", "Bird masses and BMR", "Mammal masses and BMR", "Cedar Creek data")
             )%>%column_spec(2:5,width="1.4cm")%>%
             column_spec(1, width = "8.5cm")%>%kable_styling(latex_options = "basic",position = "center")
```

<!--summary table : results with multi-variate data-->
```{r tab_multivar_summaryl, echo=F, results='asis',message=F}
tab_multivar_summary<-readRDS("./Results/tab_multivar_summary.RDS")
tab1<-tab_multivar_summary[c(1:7,9,11,12,14,16),] # see carefully if you rearrange tab_multivar_summary's row
                                                   #in suppmat this will change
tab2<-tab_multivar_summary[c(8,10,13,15,17),]  # see carefully if you rearrange tab_multivar_summary's row
                                                   #in suppmat this will change

two_tab_in1 <- as.data.frame(do.call(cbind, lapply(1:ncol(tab1), function(i) paste0(" (",tab1[c(7:8,10:12),i], " , ",tab2[ , i], ")") )))   # see carefully if you rearrange tab_multivar_summary's row in suppmat this will change

colnames(two_tab_in1)<-colnames(tab_multivar_summary)
rownames(two_tab_in1)<-c("CI_LT","CI_UT","CI_Pl","CI_Pu","CI_Pl-Pu")

tab_multivar_summary<-rbind(tab_multivar_summary[c(1:6),],
                            two_tab_in1[1:2,], #CI of LT, CI of UT
                            tab_multivar_summary[11,],
                            two_tab_in1[5,] #CI of Pl-Pu
                           )

row.names(tab_multivar_summary)<-NULL
library(kableExtra)
library(dplyr)
library(tibble)
dt <- tibble(
            Description = c("1. Location pairs (excluding self comparisons)",
           "2. Number of non-independent pairs",
           "3. Number of pairs with non-N copula as best fit",
           "4. Average AIC-weights of best-fitting copulas across location pairs",
           "5. Average AIC-weights of N copula across pairs",
           "6. Number of well-fitting location pairs",
           "7. 2.5$^{th}$ and 97.5$^{th}$ quantiles of model-avg. lower-tail dependence",
           "8. 2.5$^{th}$ and 97.5$^{th}$ quantiles of model-avg. upper-tail dependence",
           "9. Percent pairs showing stronger lower tail dependence",
           "10. 2.5$^{th}$ and 97.5$^{th}$ quantiles of $<$P$_{l}$ - P${_u}$$>$ across all location pair")
           )

tab_multivar_summary<-cbind(dt,tab_multivar_summary)

knitr::kable(tab_multivar_summary[1:9,], 
             format="latex", escape = F,
             caption.short = "Summary of results for multivariate datasets",
             caption = "Summary of results for multivariate datasets. Rows 3-9 of the table were computed for the non-independent pairs (row 2) only. A well-fitting location pair (row 6) was one for which the best-fitting copula had $p$-values $>0.01$ for both the Cramer-von Mises and Kolmogorov-Smirnov goodness of fit tests. \\label{tab_multivar_summary}",
             booktabs=T, linesep = "\\addlinespace",
             col.names = c(" ","Green spruce aphid abundance",
                        "Leaf-curling plum aphid first flight",
                        "\\textit{Ceratium furca} abundance","Methane flux")
             )%>%column_spec(2:5,width="2.5cm")%>%
             column_spec(1, width = "7cm")%>%kable_styling(latex_options = "basic",position = "center")
```

<!--Question 2 analyses-->
# Background, concepts and methods for Q2: Causes and mechanisms of non-normal copula structure \label{Causes}

Having demonstrated that non-N copula structure and asymmetric tail dependence are common
features of ecological data, we addressed Q2 by exploring via mathematical 
models and simulations three possible mechanisms of this structure which 
seem likely to operate in diverse ecological and evolutionary scenarios. The first mechanism 
is an extension of the well known Moran
effect, and was summarized conceptually in the Introduction. 
It explores the hypothesis that non-N copula structure and asymmetric tail dependence 
between environmental variables measured through time 
in two places may bring about similarly 
structured dependence between ecological variables in those places that are influenced by the 
environmental variables. 

Let $E_i(t)$ be an ecological variable 
measured in location $i$ ($i=1,2$).
We initially assumed the variable follows AR(1) dynamics within a location, 
$E_i(t+1)=\beta E_{i}(t)+ \sqrt{1-\beta^2} \epsilon_i(t)$. 
We used $\beta=0.5$. Here the $\epsilon_i(t)$ represent environmental noise; they are 
standard-normal random variables that are independent for distinct times, $t$, but 
that were made to exhibit different kinds of 
dependence across locations in different simulations (see below).
The ecological variable, $E$, is very general, and could represent, for instance, deviations
of a population density from a carrying capacity or average density, deviations of
total plant community biomass or other community variable from an average value,
or flux of a biogeochemical variable such as methane or CO$_2$.

To explore the importance of nonlinear dynamics for our hypothesis, we also considered 
nonlinear population models based on $P_i(t+1)=P_i(t)\exp \left(r\left(1-P_i(t)/K  \right) \right)+\sigma\epsilon_i(t))$, using $r=0.5$, $K=100$, and $\sigma=0.1$ or 
$\sigma=1$. When $\sigma=0.1$, population dynamics stay close to the carrying capacity, 
$K$, and the nonlinearities of the model have limited influence on dynamics. When
$\sigma=1$, model dynamics are strongly nonlinear. We refer to these as
the weak-noise and strong-noise cases, though the importance of the noise here
is that, when it is strong, it brings the nonlinearities of the model strongly into play. 
The $\epsilon_i(t)$ were again standard
normal and independent through time, but were related (see below) across locations.

For each of the three model setups, for each of the copulas C, SC, G, SG, J, SJ,
for each Kendall correlation value $\tau=0.1,0.2,\ldots,0.9$, and for each of
$50$ replicate simulations, we generated 5000 noise pairs 
$(\epsilon_1(t),\epsilon_2(t))$ from the
bivariate random variable with the given copula family and the given $\tau$.
We then used the generated noise to drive the model, and retained both the
noise and population values for the final 500 
time steps of the simulation. For each simulation, the following
statistics were computed for both the noises and populations: 
Pearson, Spearman and Kendall correlations, $\cor_l$, $\cor_u$, $\Ps_l$, $\Ps_u$, 
$\Dsq_l$, $\Dsq_u$, $\cor_l - \cor_u$, $\Ps_l - \Ps_u$, and $\Dsq_u - \Dsq_l$. 
Values were plotted for noises and populations against $\tau$. If the hypothesis is
correct that copula structure between locations of environmental noise can be 
transmitted to produce similar dependence structure for ecological variables, 
plots should be similar for populations and noises. 

The second mechanism we explored, which was also summarized in the 
Introduction,
relates to Liebig's law of the minimum, or, more generally, to the fact that 
environmental variables can often influence ecological variables through nonlinear 
relationships. If an environmental variable influences an ecological variable
more strongly in one of its tails, we explored using a model 
whether the ecological variable
could then exhibit asymmetric tail dependence between measurements made in two
locations. Let $E_i(t)$ again be an ecological variable measured in locations
$i=1,2$. Assume $E_i(t)$ has dynamics that follow 
$E_i(t+1)=bE_i(t)+g(\epsilon_i(t))+a \delta_i(t)$, where $g$ is a function
describing how the environmental variable $\epsilon_i(t)$ influences
$E_i(t)$, and the $\delta_i(t)$ are standard-normally distributed 
local noise, independent across time and sampling locations. We used $a=0.2$, and 
$b=0.1, -0.1, 0.5, -0.5$ in different simulations. 
Negative values of $b$ correspond to overcompensating dynamics 
and positive values correspond to undercompensating dynamics; larger-magnitude $b$
means that the model has a slower return time to equilibrium after a perturbation. 
The $(\epsilon_1(t),\epsilon_2(t))$ were drawn, independently through
time, from a bivariate normal distribution with $\var(\epsilon_i)=1$ and 
$\cov(\epsilon_1,\epsilon_2)=0.8$. 
We used $g$ equal to $g_1$ or $g_2$ in two different simulations:
$g_1(\epsilon)$ equals $\epsilon$ if $\epsilon<0$ and $0$ otherwise; and 
$g_2(\epsilon)$ equals $\epsilon$ if $\epsilon>0$ and $0$ otherwise. Thus
$g_1$ represents environmental effects that occur only for negative 
values and $g_2$ only for positive values of the environmental variables.
Note that both $(\epsilon_1,\epsilon_2)$
and $(\delta_1,\delta_2)$ have N copula structure, being drawn from 
bivariate normal distributions. Hence the Moran-like mechanism discussed
previously cannot be operating in this model.

For each value of $b$, we simulated the model once using $g_1$ and once using $g_2$, for $25000$ time
steps in both cases, retaining $E_1(t)$ and $E_2(t)$ for the final $2500$ time 
steps of each simulation. We applied our model selection algorithms and 
non-parametric statistics, which were previously applied to 
data to answer Q1, to the 
simulation outputs to discover if the model could
give rise to non-N copula structure and asymmetric tail dependence in the 
ecological variable, in spite of the absence of such structure in the driver
environmental variables.

The third mechanism we explored is evolutionary, and pertains to bivariate 
trait data across species, e.g., to our bird and mammal BMR versus body mass 
data. This mechanism is a hypothetical explanation for the right tail dependence
observed in those data (Fig. \ref{fig_biv_multi_raw_cop}F,G). 
We simulated bivariate character evolution on an estimate of 
the phylogeny, taken from @GenoudIM2018, of $817$ mammal species.
The root character state and the change 
across each branch were randomly chosen from matrices of one million different
bivariate draws from distributions showing one of five distinct types of copula 
structures: 1) extreme left-tail dependence, 2) moderate left-tail dependence,
3) symmetric tail dependence, 4) moderate right-tail dependence, and 5) extreme
right-tail dependence (Appendix \ref{SM-evol_mech} for details). 
All marginal distributions were standard normal, and distributions all had Spearman 
correlation $0.875$ between their two components, so our simulations assess 
the impact only of copula structure in evolutionary character
changes on evolutionary outcomes. For each of the five copula structures, mammalian character
evolution was simulated 100 times. For each simulation, symmetry of tail dependence 
of the two characters across the phylogeny tips was assessed.
We hypothesized that cases 1 and 2 above would yield stronger left- than right-tail 
dependence, and cases 4 and 5 would yield the reverse. 
The simulator was written in Python and used version 4.4 of the DendroPy 
package [@DendroPy].

# Results for Q2: Moran-like effects and asymmetric dependencies produce non-normal copula structure\label{Results_Q2}

The hypothesis that copula structure and tail dependence between environmental 
variables measured through time in different locations can produce similar 
structure in ecological variables influenced by the environmental variables was
largely confirmed, though similarities between environmental- and 
ecological-variable copula structure and tail dependencies can be reduced when the
intrinsic dynamics of the ecological variable are strongly nonlinear.
For simulations using AR(1) models (see section on methods for Q2), copula 
statistics were always very similar for noise and populations 
(Fig \ref{fig_Cause4copula_scatter_C_kend_ar1}, 
\ref{SM-fig_Cause4copula_C_kend_ar1}-\ref{SM-fig_Cause4copula_SJ_kend_ar1}),
though there were significant but minor differences for some statistics
and simulations.

\begin{figure}[!h]
\begin{center}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_CorlmCoru_Kendall's Tau.pdf}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_PlmPu_Kendall's Tau.pdf}
\includegraphics[width=5 cm]{./Results/Cause4copula_results/Cause4copula_stat_results_ar1_beta_0.5_Clayton/Clayton_scatter_D2umD2l_Kendall's Tau.pdf}
\caption{Example results showing similarity of copula statistics for 
environmental-noise inputs and ecological-variable outputs of a dynamical model.  
Asymmetric tail dependence was similar in both noise inputs and model outputs
for this model. The 
AR(1) model and a Clayton copula were used (see methods section for Q2).
Each point is the mean across 50 replicate simulations for which the same 
Kendall $\tau$ value was used. Error bars are standard errors 
and panel headers give Pearson correlation results for
the points. The regression line through the points (black line) was similar
to the 1-1 line (green line). 
See Fig. \ref{SM-fig_Cause4copula_C_kend_ar1} for additional results for the AR(1) model and Clayton copula, 
Figs \ref{SM-fig_Cause4copula_SC_kend_ar1}-\ref{SM-fig_Cause4copula_SJ_kend_ar1} for AR(1) results for other copula families, and 
Figs \ref{SM-fig_Cause4copula_C_kend_sRicker_nsd_0.1}-\ref{SM-fig_Cause4copula_SJ_kend_sRicker_nsd_1} for
the other models described in the methods for Q2.\label{fig_Cause4copula_scatter_C_kend_ar1}}
\end{center}
\end{figure}

For weak noise and using our nonlinear model (methods for Q2), copula statistics
were again very similar for noise and model outputs 
(Figs \ref{SM-fig_Cause4copula_C_kend_sRicker_nsd_0.1}-\ref{SM-fig_Cause4copula_SJ_kend_sRicker_nsd_0.1}).
Though there were again significant but small differences for some statistics
and simulations, the overall hypothesis that copula structure in the noise translates
to similar but not identical copula structure in output populations, at least
as measured with the tail dependence and correlation statistics we used, was
supported. Since many ecological models are nonlinear, this result provides the 
important expectation that there will be a Moran-effect-like correspondence 
between noise and model-output copula structure for typical ecological dynamics,
as long as the noise is small enough that dynamics stay relatively close
to the model equilibrium. Results that hold for "weak noise" in this sense
are common in ecology. 
We repeated the analysis with $r=1.3$, with similar results. The deterministic 
one-habitat-patch Ricker model exhibits a monotonic approach to a stable equilibrium
at $K$ when $r<1$ (undercompensating dynamics), but exhibits 
an oscillatory approach to $K$ when $r>1$ (overcompensating
dynamics).

For strong noise and using our nonlinear model (methods for Q2), 
copula statistics, generally speaking, were approximately similar 
between noise and model
outputs; however, similarity was reduced relative to the AR(1) 
and weak-noise cases, and, for a few simulations, tail dependence 
asymmetry statistics
even had opposite signs for noise and model outputs 
(Figs \ref{SM-fig_Cause4copula_C_kend_sRicker_nsd_1}-\ref{SM-fig_Cause4copula_SJ_kend_sRicker_nsd_1}). For instance, using a C copula with a large Kendall $\tau$,
$\cor_l - \cor_u$ was slightly positive for noise, but slightly negative for 
population model outputs (Fig. \ref{SM-fig_Cause4copula_C_kend_sRicker_nsd_1}); 
and likewise for SG and SJ copulas (Figs \ref{SM-fig_Cause4copula_SG_kend_sRicker_nsd_1}, 
\ref{SM-fig_Cause4copula_SJ_kend_sRicker_nsd_1}). Dynamics were
strongly nonlinear for the model parameters we used, and nevertheless similarities
between noise and model-output copula structure, according to the statistics 
we used, were more noticable than discrepancies.
We again repeated the analysis with $r=1.3$. Discrepancies between noise and population
copula structure in this case were often glaring. Apparently noise of standard deviation 1
interacted very strongly with model nonlinearities when the model was in its overcompensatory 
regime.  

Our model with environmental effects which differed in the
two tails could produce simulated ecological variables with visually apparent asymmetry 
of tail dependence and non-N copula structure, depending on the value of $b$ used. 
For $b=0.1$ (Fig. \ref{fig_ms_asym_b_0.1}) and $b=-0.1$ (Fig. \ref{SM-fig_ms_asym_b_-0.1}), 
for both $g_1$ and $g_2$,
asymmetric tail dependence and non-N copula structure were visually apparent.
We also got similar results from simulations with $b=\pm 0.5$ (Figs \ref{SM-fig_ms_asym_b_0.5} - 
\ref{SM-fig_ms_asym_b_-0.5}).
Lower-tail (respectively, upper-tail) effects of the noise ($g_1$, respectively, $g_2$) 
produced lower-tail (respectively, upper-tail) dependence in the ecological variable.
Model selection results (Table \ref{SM-tab_summary_stat_asym_sens}) confirmed that
non-Normal copula was always best fit for $b= \pm 0.1$ and $\pm 0.5$, but their model 
AIC-wieght averaged tail dependence could not reflect the asymmetry for each case 
when that dependnece was at too much extreme end.
However, our nonparametric statistics (Tables \ref{SM-tab_stat_npa_asym}) focused on those extreme tips
and overcome the shortcomings of model selection approach which fit data based on maximum likelihood. 

\begin{figure}[!h]
\begin{center}
\includegraphics[width=12 cm]{./Results/asym_sens_results/a_0.2_b_0.1_r_0.8_asym_sens.pdf}
\caption{If environmental effects operate asymmetrically in their tails on
ecological variables, it can result in non-N copula structure and asymmetric 
tail dependence across space in the ecological variables. Shown are the last
$500$ points for (A) $g=g_1$ and (B) $g=g_2$ from simulations described in the text.\label{fig_ms_asym_b_0.1}}
\end{center}
\end{figure}

Our hypothesis was correct that asymmetric tail dependence in evolutionary changes in bivariate
characters can give rise to similarly asymmetric tail dependence in character distributions across
phylogeny tips (Appendix \ref{SM-evol_mech}). This topic is revisited in the Discussion.

<!--Question 3 analyses-->
# Background, concepts and methods for Q3: Consequences of non-normal copula structure for our understanding of ecology \label{Consequences}

We addressed Q3 using both models and data. An initial 
idea was presented in the Introduction that
the distribution (through time) of a spatially averaged quantity should be influenced by the 
nature of the dependence between the local quantities being averaged, including their
copula structure and tail dependence. For instance, suppose $E_i(t)$ are ecological
variables measured at locations $i=1,\ldots,N$ and times $t=1,\ldots,T$, and suppose 
the distribution and temporal dynamics of the spatial average $\sum_i E_i(t)/N$ is of
interest. The $E_i(t)$ could be, for instance, local abundances of a pest or 
exploited species, or local fluxes of a greenhouse gas. If  $E_i$ and $E_j$ are 
strongly right-tail dependent for all or most location pairs $i$ and $j$, then
exceptionally large values tend to occur at the same time in all or most locations.
This should tend to increase the skewness of the distribution through time of the
spatial average. Similarly, left-tail dependence between local variables
will tend to decreases skewness of the spatial mean. Positive skewness of the 
spatial mean corresponds to the "spikiness" of the spatial-mean time series. 
The spatial-mean time series and its skewness may be quantities of 
principal importance for 
cases such as pest or resource abundance, for which extreme values (spikes) 
in the spatial-mean
quantity have disproportionately large effects.

We tested these ideas using the focal multivariate datasets of our earlier analyses:
green spruce aphid abundance data, leaf-curling plum aphid first flight data, \emph{Ceratium
furca} abundance data, and methane flux data (see Data and Table \ref{tab_multivar_summary}).
For each dataset we calculated the spatial mean, and then the skewness (through time) of that
mean. Then, for each dataset separately, we compared the value obtained 
to a distribution of values 
of the same quantity calculated for each of 10000 surrogate datasets. Surrogate 
datasets were produced from the empirical data by randomizing
it in a special way so that surrogate/randomized dataset had the 
copula structure of a multivariate-normal distribution
(Appendix \ref{SM-Surrog_multi}). The surrogate datasets had exactly the same
distributions of values for each sampling location as the original data. 
They also had very similar Spearman correlations between pairs of sampling locations
as the original data. 
Our comparisons therefore tested the null hypothesis that the skewness of the spatial 
mean took values on the empirical data no different from what one would expect if the copula
structure of the data were multivariate normal, but the data were otherwise statistically
unchanged. Significant differences indicate that non-N copula structure in the data 
contributed to the skewness of the spatial mean, i.e., to the "spikiness" of that
time series.

For green spruce aphid abundance data, *Ceratium furca* abundance data, and methane-flux
data, because these datasets exhibited lower-tail dependence 
(Table \ref{tab_multivar_summary}), we compared empirical and surrogate skewness values
via a one-tailed test in the left tail: the $p$-value result was simply the fraction
of surrogate skewnesses less than the skewness computed from the empirical data; the test
examines whether lower-tail dependence made the spatial average have a significantly lower
skewness than would have been expected without tail dependence. For
leaf-curling plum aphid first flight data, because this dataset exhibited upper-tail 
dependence (Table \ref{tab_multivar_summary}), we did the analogous one-tailed test
in the right tail. The test examines whether upper-tail dependence made the spatial
average of the first-flight data have significantly higher skewness than would have been
expected without tail dependence.

We also examined whether the nature of the
tail dependence of an environmental variable across space could influence the 
extinction risk of a metapopulation. We hypothesized that environmental noises
exhibiting greater left-tail dependence across different habitat patches would 
cause higher metapopulation extinction risks because then bad years for the 
component populations would occur simultaneously in many patches,
reducing rescue effects. Here, we are assuming that low values of the environmental
variable are "bad" for the populations being modelled, and high values are "good".
We provided a test of the conceptual validity of this hypothesis using a metapopulation
extension of the Lewontin-Cohen model,
$\vec{P}(t+1) = D \lambda(t) \vec{P}(t)$,
where $\vec{P}(t)$ is a vector of population densities, 
the $i^{th}$ component $P_i(t)$ representing
the density in the $i^{th}$ habitat patch ($i=1,\ldots,N$) at time $t$. 
The $N \times N$ matrix $\lambda(t)$ was diagonal with $i^{th}$ diagonal entry 
$\exp(r+\epsilon_i(t))$. Here $r$ is a growth rate; we used $r=0$. The
$\epsilon_i(t)$ represent environmental noises in each patch. They were standard-normally 
distributed in each patch, were independent through time, and showed the same 
spatial correlations (to within sampling error) for every simulation, 
but were made to exhibit right- or left-tail dependence between patches in
different simulations (Appendix \ref{SM-ext_risk_model}). The $N \times N$
matrix $D$ was a dispersal matrix. For simplicity, we considered habitat patches 
to be arranged in a line, with dispersal occurring either to nearest neighbors only,
or globally, in different simulations. The dispersal 
rate was $d$ (Appendix \ref{SM-ext_risk_model}). After each time step, 
if the population density in a patch was below $1$ (an extinction threshold), it was
set to $0$. We simulated the model 10000 times for each combination of parameters,
starting from initial populations $p_0 = 50$ in each patch, 
and calculated extinction risk after $25$ time steps.

## Results for Q3: Tail dependence influences skewness of spatial average, extinction risk, and Taylor's law

\begin{figure}[!h]
\textbf{ \hspace{6.6 cm} (A) \hspace{4.6 cm} (B)} \\
\vspace{-0.4 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/skewness_results/skewness_aphid_count/skewness_aphid_count_sp_10_spearman.pdf}
\includegraphics[width=5 cm]{./Results/skewness_results/skewness_aphid_ff/skewness_aphid_ff_sp_11_spearman.pdf}\\
\end{center}
\vspace{0.2 cm}
\textbf{ \hspace{6.6 cm} (C) \hspace{4.6 cm} (D)} \\
\vspace{-0.4 cm}
\begin{center}
\includegraphics[width=5 cm]{./Results/skewness_results/skewness_plankton_north_sea/skewness_plankton_north_sea_sp_16_spearman.pdf}
\includegraphics[width=5 cm]{./Results/skewness_results/skewness_methane/skewness_methane_spearman.pdf}
\caption{Skewness of spatially averaged green spruce aphid abundance $(A)$, leaf-curling plum 
aphid first flight dates $(B)$, \emph{Ceratium furca} abundance $(C)$, and methane-flux
$(D)$ time series compared to an multivariate 
N-copula null hypothesis. Black dots are empirical 
skewnesses; see text 
and Appendix \ref{SM-Surrog_multi} for details of the null hypothesis. Results show a 
tendency for skewness of the spatial average to be affected as hypothesized 
by tail dependence. \label{fig_skewness_spearman}}
\end{center}
\end{figure}

\noindent Skewness results were generally consistent with hypotheses. For the datasets that
exhibited strong lower-tail (respectively, upper-tail) 
dependence in earlier analyses (namely, the green spruce 
aphid abundance data for lower-tail, and the leaf-curling plum aphid first flight data
for upper-tail, Table 
\ref{tab_multivar_summary}), the skewness, through time, of the spatial average of the 
empirical data was less than (respectively, greater than) a significant fraction (i.e.,
more than $95\%$) of the
surrogate skewness values 
(Fig. \ref{fig_skewness_spearman}A,B). For the datasets that demonstrated a 
more moderate lower-tail dependence in earlier analyses (the 
\emph{Ceratium furca} abundance and the methane data), skewness of the spatial
average showed a non-significant tendency toward being less than surrogate skewnesses
(Fig. \ref{fig_skewness_spearman}C), or was less than a marginally significant 
fraction of surrogate skewnesses (Fig. \ref{fig_skewness_spearman}D). 

As hypothesized, left-tail dependent environmental fluctuations increased metapopulation
extinction risk for the spatially 
extended Lewontin-Cohen model (Fig. \ref{fig_extrisk_lcohen_local}). 
This was true for both $N=5$ and $N=25$ habitat patches, and for both local 
(Fig. \ref{fig_extrisk_lcohen_local}) and global (Fig. \ref{SM-fig_extrisk_lcohen_global})
dispersal. We also examined the influence of non-N copula structure and tail dependence
on Taylor's law in Appendices \ref{SM-Consequence_TL_simulation} and 
\ref{SM-sect:copsurrognd}.

\begin{figure}[!h]
\textbf{ \hspace{6.6 cm} (A) \hspace{4.2 cm} (B)} \\
\vspace{-0.8 cm}
\begin{center}
\includegraphics[width=10 cm]{./Results/ext_risk_copula/lcohen_ext_risk_local_disp.pdf}
\caption{Extinction risk for the metapopulation extension of the Lewontin-Cohen model, after 
$25$ time steps, was higher for left-tail-dependent environmental noise. Dispersal was local,
with dispersal rate $d$ (Appendix \ref{SM-ext_risk_model}). Simulations used $N$ patches
for $N=5$ (A) and $N=25$ (B).\label{fig_extrisk_lcohen_local}}
\end{center}
\end{figure}

# Discussion \label{Discussion}

<!--what we did and why is it important to study?-->
We have shown that non-N copula structure and asymmetric tail dependence are 
exceedingly common in datasets that range across multiple sub-disciplines
and levels of organization in ecology, in spite of the fact that no published 
ecological research we are aware of has 
taken this structure into account. Via simple mathematical models, we hypothesized two 
mechanisms that may cause non-N copula structures with asymmetric tail dependence
in ecological data. One
mechanism was via a Moran-like effect by which the dependence structure between ecological
variables (measured through time at different locations) is shaped by the dependence structure of 
environmental variables (measured at the same times and locations). 
A second mechanism gives rise to non-N copula structure and asymmetric tail dependence via
the asymmetric or nonlinear influence of environmental variables on ecological variables, 
and relates to Liebig's law of the minimum. We discuss below how commonly these and other
potential mechanisms may opperate. 
We also demonstrated important consequences of 
non-N and tail-dependent copula structure in ecology. First, the skewness, through time, 
of the spatial average of time series from different locations (e.g., average regional pest abundance computed from local pest abundances) is affected by the tail dependence of the relationships
between the local quantities. Thus right-tail-dependent local quantities 
tend to produce "spiky" spatially averaged time series, with large outbreaks. 
Second, metapopulation extinction risk can be accentuated or reduced by the tail dependence
properties of environmental variables that influence the populations. Finally, 
simulation results in Appendix \ref{SM-Consequence_TL_simulation} 
showed that spatial Taylor's law can be strongly influenced by
tail dependence between local populations. In our view, our results demonstrate that, for many
ecological phenomena, complete understanding is impossible without 
characterizing dependence between variables using copulas. 

<!--A para about what is available in the copula and VineCopula packages. Maybe make it a broader para about emthods, and state in there that we developed some new surrogate methods that may be broadly useful for researches trying to incorporate copula approaches.-->
Copula approaches are
well developed, statistically [@joe2014_dependence; @nelsen2006_copula], and 
computer implementations exist (e.g., the `copula` and 
`VineCopula` packages in R). Ecologists need only become aware of these tools
and understand them conceptually to start applying them broadly. 
We created a variety of interrelated randomization procedures
(Appendices \ref{SM-surrog_test}, \ref{SM-Surrog_multi}, \ref{SM-sect:copsurrognd}) 
that build upon existing methods and may be especially useful for ecological applications.

<!--some mechanism paragraphs follow-->

<!--Maybe a para on how likely one is to get copula structure via the Moran mechanism - considers
work on copula structure in environmental variables. Maybe mention possible future work: 
study copula structure of environmental variables (such as temperature and precip) that are known 
to be important in ecology, including how such copula structure may be changing and whether it 
has a geography of the kind studied in Walter et al.-->
One may expect our Moran-like mechanism for non-N copula structure and tail dependence to 
operate commonly, because Moran effects are common [@Liebhold2004], and 
non-N and tail-dependent copula structures have often been found in prior analyses of 
environmental variables. A recent study [@agliardi2019relationship] found non-N 
copulas (mainly Gumbel and Survival Clayton) were better fit in modelling the 
upper tail dependence between extreme large values for global 
temperature and annual mean green house gas concentrations for an extensively
long datasets (1880-2017). If large meteorological events are also spatially widespread, then
one would expect environmental variables associated with these events to take extreme
values simultaneously across large spatial areas, producing tail dependence in measurements
made at different locations. Non-extreme values, not associated with extreme events, may
be more associated with local weather phenomena, and therefore 
less prone to being correlated across large areas.
Using a bivariate mixed model approach with copulas, 
@Serinaldi2008 examined the spatial dependence 
of rainfall observations (7 years with 30 minute time resolution) 
within a rain gauge network in Central Italy. Gumbel or Student 2-copulas 
were possible candidates for modelling bivariate dependence at several time scales, and 
neither of these is an N copula. @liu2016probabilistic used a copula 
based approach in assessing the drought risk with joint probability distribution 
between vegetation and climatic variables across China. 
In a majority of their cases, they found 
non-N copula structure in the dependence between a vegatation index 
and climatic variables (e.g., precipitation and temperature). 
Another long-term study (1950–2014) in the Loess Plateau of China [@She2018]
showed that a Gumbel copula (which has upper tail dependence) could effectively model 
the spatial dependence of drought variables 
(duration and severity) in the study area. Bivariate copula analysis was also used in forecasting the 
co-occurrence of extreme events (flood or drought) 
over the North Sikkim Himalayas, India, using spatial data sets at different 
time scales [@Goswami2018]. 

<!--Maybe a para on how likely one is to get copula structure via the Liebig mechanism - considers
what people have written on nonlinear effects and empirical evidence for Liebig's law and so on-->
There are also good reasons to expect that our second mechanism operates commonly. 
The second mechanism is the one that involves asymmetric or nonlinear influences of 
environmental variables. Liebig's law of the minimum and the idea of a "limiting 
nutrient" of organism or population growth are fundamental and dominant paradigms in ecology.
Furthermore, innumerable studies document nonlinear influences of environmental
variables on important ecological quantities at all levels of organization, e.g., the 
influence of temperature on: 
individual metabolism and autotroph growth rates 
[@GarciaCarreras2018]; dispersal [@Oconnor2007]; population growth 
[@Savage2004]; and microbial and ecosystem methane flux [@YvonDurocher2014].
Environmental variables influence not only ecological populations, but also physiological,
community, and ecosystem functioning measurements. So our two mechanism may well operate
to produce spatial copula structure in a wide variety of ecological measurements.

<!--Holder stuff-->
Our simulations of character evolution suggest the hypothesis that evolutionary
changes through time in bird and mammal BMR and body size may exhibit right-tail dependence. This is
a hypothesis only, because the right-tail dependence of Fig. \ref{fig_biv_multi_raw_cop}F,G
could have come about in another, unknown way: our simulations show that tail dependence 
in evolutionary changes is sufficient, but may not be necessary, to produce tail
dependence in characters of extant species. For instance, as discussed below and in
Appendix \ref{SM-sect:missingdata} (see also Fig. \ref{SM-fig:missingdata}), 
systematically missing data can produce tail dependence and may
have influenced results for the BMR versus body mass datasets. Even if the hypothesized 
evolutionary mechanism
is correct, our results simply replace one question, i.e., why do we see right-tail
dependence between BMR and body mass for birds and mammals, with another question,
i.e., why might we see right-tail dependence in evolutionary changes of these traits?
See Appendix \ref{SM-evol_mech} for additional thoughts on the potential importance of 
copulas for studies of character evolution when phylogeny branch lengths are not available.

<!--Discuss stuff here on tradeoff and life history that Bever told me about-->
The relationships we studied between BMR and body mass relate
to a trade-off between mass-specific BMR (i.e., BMR per unit body mass) and body
mass itself. Trade-offs between life history characteristics are a focal topic in 
evolutionary ecology. There are reasons to believe copulas interrelate with 
life-history theory in additional ways beyond what we could demonstrate 
with the data we used.
It is well known that energy allocation to a life function, X (e.g., reproduction)
will reduce the energy that can be allocated to other functions, $Y_1$, $Y_2$, $Y_3$ 
(e.g., growth, predation avoidance; this is sometimes called the principle of 
allocation).
But it is equally well known that X can trade-off against any or all of 
the $Y_i$. Therefore, for large values of X which approach absolute 
limitations, there may be a strong 
association between X and $Y_1$. Whereas for small values of X there may be
little association - resources not allocated to X can instead be allocated 
to $Y_1$ or $Y_2$ or to some combination. This constitutes 
asymmetric tail dependence between X and $Y_1$. For instance, \cite{Winemiller1992}
described a three-way trade-off in North American fishes between age of reproductive
maturity, juvenile survivorship, and fecundity. The trade-off should
produce a tight association between age of maturity and fecundity for 
fishes with low age of maturity, but little association between those
variables for later-maturing
fishes because those fishes may invest much or little in juvenile survival.
Although copulas may be very useful for studying multi-dimensional trade-offs, 
applications will 
require careful attention to the possible consequences of biased sampling:
if the degree of completeness of a dataset is associated with one or
more of the quantities being studied then statistical artefacts
may bias conclusions of copula analyses (Appendix \ref{SM-sect:missingdata}, 
Fig. \ref{SM-fig:missingdata}).

<!-- We have only given a few mechanisms, but there are likely to be others, and discoverig
additional mechanisms of copula structure is certainly worthy of future work. -->
Other mechanisms that we have not considered probably also operate to produce copula structure
in ecological and evolutionary datasets, and should be considered in future work. For instance, 
measurement error may modify copula structure, though one would have to have information
on the precise nature of measurement error in a dataset to explore its influence. 
Not only did the models we used to explore mechanisms not consider measurement error, 
they were intentionally simple in other respects, as well, not including phenomena such as 
delayed density dependence, dispersal, stage structure in population dynamics, and trophic
interactions.
We hope by enumerating a few potential mechanisms of copula structure in data 
we help inspire additional research on the
potentially numerous mechanisms that may operate in diverse datasets.

<!--some consequences paragraphs next-->

<!--a para on stability of the total biomass time series in a community, and skewness - sets up Shya's later paper as future work-->
Our results showed that the skewness of the 
spatial average of local time series from different locations is influenced 
by their tail dependence. But the logic of this result should also apply to any collection of time
series, whether associated with different locations in space or not, that are summed or averaged. 
Another potential application is time series of all species from a single community, e.g., all
plants in a quadrat or survey site (REF) or all herbivorous plankton in a lake (REF). A huge 
literature has focused on synchrony versus compensatory dynamics between such time series (REFS), and 
the influence of such interspecific relationships on the variability, through time, of total-community
properties such as total biomass. Typically, variability through time of total-community
properties is measured with the coefficient of variation, but the skewness of such a time series
may also be of interest: it can characterize the extent to
which community properties show "spikiness," i.e., uncharacteristically extreme values. 
Therefore, future work on copula structure of intraspecific relationships in communities and its
influence on community properties seems likely to us to be a potentially very exciting avenue.

<!--A para that sets up Shya's extinction risk paper-->
Although we have demonstrated that tail dependence between environmental variables
can influence extinction risk, substantial work remains to be done regarding the 
circumstances under which this result holds, and its magnitude in different scenarios. 
First, we used 
a non-density dependent model to examine extinction risk. Does tail dependence
in environmental variables still influence extinction risk when density dependence
plays a role? Second, we considered metapopulation extinction risk, but the large field 
of population viability analysis (PVA) via stochastic 
matrix modelling [@Caswell2000; @MorrisDoak2002]
uses a framework in which a single population's vital rates (e.g., life-stage-specific 
fecundity and survival rates) are considered to
vary stochastically through time due to environmental variation. Do relationships
between different vital rates exhibit tail dependence, and does tail dependence 
influence extinction risk of a single population?
PVA is one of the routes by which a species can be added to the influential
International Union for the Conservation of Nature (IUCN) red list of threatened
species. It seems worthwhile for future research to investigate the extent to which 
copula structure in dependences between vital rates may occur and may influence
estimates of risk. Finally, is the copula structure of environmental variables
changing through time, and, if so, how do such changes influence extinction risks?
Climate change is known to amplify the factors that lead to extreme weather events
[@Hansen2012]. Extreme events, by definition, produce values in the right tails of distributions
of environmental variables. Extreme weather events also tend to be spatially extensive, so
increased frequency of extreme weather events may correspond to changes in the tail dependence
environmental variables measured in different places, and we showed such changes
can affect extinction risk. It seems
important for future work to explore whether such effects are of sufficient 
commonness and magnitude to interest conservationists. 

# Acknowledgments

We thank the many contributors to the large datasets we used; D. Stevens and P. Verrier for data 
extraction; and Joel E. Cohen, David Tilman, Lauren Hallet, Jonathan Walter, Thomas 
Anderson, and Lei Zhao for helpful suggestions. We thank James Bell of the Rothamsted Insect Survey 
(RIS). 
The RIS, a UK Capability, is funded by the Biotechnology and Biological Sciences Research Council 
under the Core Capability Grant BBS/E/C/000J0200. SG, LWS and DCR were partly funded by US National 
Science Foundation grants 0075516 and 1442595 and the James S McDonnell Foundation. 

\clearpage

# References
\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{1pt}
\noindent


